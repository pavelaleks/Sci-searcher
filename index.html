<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sci-Searcher | –ü–æ–∏—Å–∫–æ–≤–∏–∫ –Ω–∞—É—á–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            /* Light theme colors */
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --accent-primary: #3498db;
            --accent-secondary: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --border-color: #e1e5e9;
            --shadow: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-hover: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        [data-theme="dark"] {
            /* Dark theme colors */
            --bg-primary: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --bg-secondary: #2c3e50;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --accent-primary: #3498db;
            --accent-secondary: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --border-color: #34495e;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
            --shadow-hover: 0 8px 25px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
            padding: 20px;
            position: relative;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
            margin: 0;
            font-weight: 400;
        }

        .version-info {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
            margin-top: 8px;
            opacity: 0.7;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .developer-info {
            margin: 20px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .developer-info p {
            margin: 6px 0;
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .developer-info a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .developer-info a:hover {
            color: #f0f0f0;
            text-decoration: underline;
        }

        .app-description {
            margin: 20px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .app-description p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.5;
            font-weight: 400;
        }

        .search-panel {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 20px;
        }

        .main-search-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 20px;
        }

        .search-input-group {
            display: flex;
            gap: 12px;
            align-items: end;
        }

        .search-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            transform: translateY(-1px);
        }

        .search-btn-main {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Inter', sans-serif;
            min-width: 160px;
        }

        .search-btn-main:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .quick-filters {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .quick-filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .quick-filter-group label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .quick-filter-group select {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            min-width: 120px;
        }

        .advanced-search-toggle {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .advanced-search-toggle:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .advanced-search-panel {
            display: none;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }

        .advanced-search-panel.active {
            display: block;
        }

        .advanced-filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .search-panel:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            align-items: start;
            max-width: 100%;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            align-items: stretch;
            max-width: 100%;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            height: 72px;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-primary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            height: 24px;
            display: flex;
            align-items: center;
            line-height: 1.2;
            flex-shrink: 0;
        }

        .form-group input, .form-group select {
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            height: 42px;
            box-sizing: border-box;
            flex-shrink: 0;
            margin-top: auto;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
            transform: translateY(-1px);
        }

        .form-group small {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-top: 3px;
            line-height: 1.3;
        }

        .search-btn {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Inter', sans-serif;
            position: relative;
            overflow: hidden;
            width: 100%;
            margin-top: 8px;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .search-btn:hover::before {
            left: 100%;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-panel {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            height: fit-content;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .results-count {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .export-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .export-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .copy-btn {
            background: #17a2b8;
        }

        .copy-btn:hover {
            background: #138496;
        }

        .results-list {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .result-item {
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            background: #fafbfc;
        }

        .result-item:hover {
            border-color: #667eea;
            box-shadow: 0 3px 8px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .result-title {
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 6px;
            line-height: 1.3;
        }

        .result-authors {
            color: #666;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .result-journal {
            color: #8e44ad;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 0.8rem;
        }

        .result-year {
            color: #e74c3c;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 0.8rem;
        }

        .result-abstract {
            color: #555;
            line-height: 1.4;
            font-size: 0.8rem;
            margin-bottom: 6px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è HTML-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö */
        .result-abstract p {
            margin: 0 0 8px 0;
        }

        .result-abstract p:last-child {
            margin-bottom: 0;
        }

        .result-abstract em,
        .result-abstract i {
            font-style: italic;
        }

        .result-abstract strong,
        .result-abstract b {
            font-weight: bold;
        }

        .result-abstract span {
            display: inline;
        }

        .result-abstract div {
            display: block;
        }

        .result-abstract br {
            line-height: 1.2;
        }

        .abstract-preview {
            max-height: 60px;
            overflow: hidden;
            position: relative;
        }

        .abstract-preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(transparent, #fafbfc);
        }

        .abstract-full {
            max-height: none;
        }

        .toggle-abstract {
            background: none;
            border: none;
            color: #667eea;
            font-size: 0.75rem;
            cursor: pointer;
            padding: 2px 0;
            margin-top: 4px;
            text-decoration: underline;
        }

        .toggle-abstract:hover {
            color: #5a6fd8;
        }

        .result-checkbox {
            margin-right: 8px;
            transform: scale(0.9);
        }

        .result-item.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .selection-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            align-items: center;
            flex-wrap: wrap;
        }

        .select-all-btn, .clear-selection-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .select-all-btn:hover, .clear-selection-btn:hover {
            background: #5a6268;
        }

        .selected-count {
            font-size: 0.8rem;
            color: #666;
            font-weight: 500;
        }

        .selection-controls .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .selection-controls .export-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .result-doi {
            color: #3498db;
            font-size: 0.75rem;
            text-decoration: none;
        }

        .result-doi:hover {
            text-decoration: underline;
        }

        .result-link {
            color: #3498db;
            font-size: 0.85rem;
            text-decoration: none;
            display: inline-block;
            margin-top: 8px;
            padding: 5px 10px;
            background: #e3f2fd;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .result-link:hover {
            background: #bbdefb;
            text-decoration: none;
            transform: translateY(-1px);
        }

        .footer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 15px 20px;
            margin-top: 20px;
            border-radius: 8px 8px 0 0;
        }

        .footer-content p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
        }

        @media (max-width: 1200px) {
            .container {
                padding: 15px;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .search-input-group {
                flex-direction: column;
                gap: 12px;
            }
            
            .search-input {
                font-size: 1rem;
                padding: 14px 16px;
            }
            
            .search-btn-main {
                width: 100%;
                padding: 14px 20px;
                font-size: 1rem;
            }
            
            .quick-filters {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            .quick-filter-group select {
                width: 100%;
            }
            
            .advanced-filters-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .results-panel {
                padding: 15px;
            }
            
            .result-item {
                padding: 12px;
            }
            
            .result-title {
                font-size: 1rem;
            }
            
            .result-authors {
                font-size: 0.8rem;
            }
            
            .result-journal {
                font-size: 0.8rem;
            }
            
            .export-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .export-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .selection-controls {
                flex-direction: column;
                gap: 8px;
            }
            
            .select-all-btn, .clear-selection-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .footer {
                padding: 10px 15px;
                margin-top: 15px;
            }
            
            .footer-content p {
                font-size: 0.8rem;
            }
        }

        .hidden {
            display: none;
        }

        .analytics-panel {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .analytics-panel h3 {
            color: var(--text-primary);
            margin-bottom: 16px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .analytics-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .analytics-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .analytics-content {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .analytics-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .analytics-item:last-child {
            border-bottom: none;
        }

        .analytics-bar {
            width: 100%;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 4px;
        }

        .analytics-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--success));
            transition: width 0.3s ease;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
            backdrop-filter: blur(10px);
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .search-type {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-type label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .search-type input[type="radio"] {
            margin: 0;
        }

        .button-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .current-year-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .current-year-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .current-year-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .quick-periods {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .period-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .period-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .period-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .period-btn.active {
            background: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }




        .results-panel {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            display: none;
            margin-top: 20px;
        }

        .results-panel.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .export-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .export-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .copy-btn {
            background: #17a2b8;
        }

        .copy-btn:hover {
            background: #138496;
        }

        .results-list {
            max-height: 70vh;
            overflow-y: auto;
        }

        .result-item {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .result-item:hover {
            border-color: #667eea;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .result-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .result-authors {
            color: #666;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        .result-journal {
            color: #8e44ad;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .result-year {
            color: #e74c3c;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .result-abstract {
            color: #555;
            line-height: 1.5;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .result-doi {
            color: #3498db;
            font-size: 0.8rem;
            text-decoration: none;
        }

        .result-doi:hover {
            text-decoration: underline;
        }

        .result-link {
            color: #3498db;
            font-size: 0.8rem;
            text-decoration: none;
            display: inline-block;
            margin-top: 6px;
            padding: 4px 8px;
            background: #e3f2fd;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .result-link:hover {
            background: #bbdefb;
            text-decoration: none;
            transform: translateY(-1px);
        }


    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                <svg viewBox="0 0 24 24">
                    <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
                </svg>
            </button>
            <h1>Sci-Searcher</h1>
            <p>–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤–∏–∫ –Ω–∞—É—á–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã</p>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–æ–∏—Å–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="search-panel">
            <form class="search-form" id="openalexForm">
                <div class="main-search-section">
                    <div class="search-input-group">
                        <input type="text" id="keywords" class="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞..." required>
                        <button type="submit" class="search-btn-main" id="openalexSearchBtn">
                            üîç –ü–æ–∏—Å–∫
                        </button>
                    </div>
                    
                    <div class="quick-filters">
                        <div class="quick-filter-group">
                            <label for="searchMode">–†–µ–∂–∏–º</label>
                            <select id="searchMode">
                                <option value="simple">–ü—Ä–æ—Å—Ç–æ–π</option>
                                <option value="advanced">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π</option>
                                <option value="exact">–¢–æ—á–Ω–∞—è —Ñ—Ä–∞–∑–∞</option>
                            </select>
                        </div>
                        
                        <div class="quick-filter-group">
                            <label for="resultsLimit">–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</label>
                            <select id="resultsLimit">
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="200">200</option>
                                <option value="300">300</option>
                                <option value="500">500</option>
                            </select>
                        </div>
                        
                        <div class="quick-filter-group">
                            <label for="startYear">–ì–æ–¥ –æ—Ç</label>
                            <input type="number" id="startYear" min="1700" placeholder="2019" style="padding: 8px 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 0.9rem; background: var(--bg-secondary); color: var(--text-primary); font-family: 'Inter', sans-serif; min-width: 120px;">
                        </div>
                        
                        <div class="quick-filter-group">
                            <label for="endYear">–ì–æ–¥ –¥–æ</label>
                            <input type="number" id="endYear" min="1700" placeholder="2025" style="padding: 8px 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 0.9rem; background: var(--bg-secondary); color: var(--text-primary); font-family: 'Inter', sans-serif; min-width: 120px;">
                        </div>
                        
                        <div class="year-range-info" style="font-size: 0.8rem; color: #666; margin-top: 5px; text-align: center;">
                            üìÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –ª–µ—Ç | –î–∏–∞–ø–∞–∑–æ–Ω: –æ—Ç 1700 –≥–æ–¥–∞ –¥–æ <span id="currentYearDisplay">2025</span> –≥–æ–¥–∞ –∏ –¥–∞–ª–µ–µ
                        </div>
                        
                        <button type="button" class="advanced-search-toggle" id="advancedToggle">
                            ‚öôÔ∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                    </div>
                </div>
                
                <div class="advanced-search-panel" id="advancedPanel">
                    <div class="advanced-filters-grid">
                        <div class="form-group">
                            <label for="filterType">–¢–∏–ø –ø—É–±–ª–∏–∫–∞—Ü–∏–π</label>
                            <select id="filterType">
                                <option value="all">–í—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</option>
                                <option value="journals">–¢–æ–ª—å–∫–æ –∂—É—Ä–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</option>
                                <option value="conferences">–ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏</option>
                                <option value="books">–ö–Ω–∏–≥–∏ –∏ –≥–ª–∞–≤—ã</option>
                                <option value="no_repositories">–ò—Å–∫–ª—é—á–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="language">–Ø–∑—ã–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                            <select id="language">
                                <option value="all">–í—Å–µ —è–∑—ã–∫–∏</option>
                                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                                <option value="kk">–ö–∞–∑–∞—Ö—Å–∫–∏–π</option>
                                <option value="en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                                <option value="de">–ù–µ–º–µ—Ü–∫–∏–π</option>
                                <option value="fr">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
                                <option value="es">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
                                <option value="zh-cn">–ö–∏—Ç–∞–π—Å–∫–∏–π (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)</option>
                                <option value="zh-tw">–ö–∏—Ç–∞–π—Å–∫–∏–π (—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π)</option>
                                <option value="ja">–Ø–ø–æ–Ω—Å–∫–∏–π</option>
                                <option value="ko">–ö–æ—Ä–µ–π—Å–∫–∏–π</option>
                                <option value="ar">–ê—Ä–∞–±—Å–∫–∏–π</option>
                                <option value="pt">–ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π</option>
                                <option value="it">–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="openAccess">–û—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø</label>
                            <select id="openAccess">
                                <option value="all">–í—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</option>
                                <option value="open">–¢–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø</option>
                                <option value="closed">–¢–æ–ª—å–∫–æ –ø–ª–∞—Ç–Ω—ã–µ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="sortOrder">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                            <select id="sortOrder">
                                <option value="newest">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                                <option value="oldest">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                                <option value="relevance">–ü–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button type="button" onclick="window.sciSearcher.testAllFilterCombinations()" 
                                    style="background: #17a2b8; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; width: 100%;">
                                üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="results-panel" id="resultsPanel">
            <div class="results-header">
                <div class="results-count" id="resultsCount"></div>
                <div class="export-buttons">
                    <button class="export-btn" id="downloadApaBtn">
                        üìÑ APA
                    </button>
                    <button class="export-btn" id="downloadGostBtn">
                        üìã –ì–û–°–¢
                    </button>
                    <button class="export-btn" id="downloadBibtexBtn">
                        üìö BibTeX
                    </button>
                    <button class="export-btn copy-btn" id="copyBtn">
                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
            
            <div class="analytics-panel" id="analyticsPanel" style="display: none;">
                <h3>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-title">–¢–æ–ø –∞–≤—Ç–æ—Ä—ã</div>
                        <div class="analytics-content" id="topAuthors"></div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-title">–¢–æ–ø –∂—É—Ä–Ω–∞–ª—ã</div>
                        <div class="analytics-content" id="topJournals"></div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–æ–¥–∞–º</div>
                        <div class="analytics-content" id="yearDistribution"></div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-title">–û—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø</div>
                        <div class="analytics-content" id="openAccessStats"></div>
                    </div>
                </div>
            </div>
            <div class="selection-controls" id="selectionControls" style="display: none;">
                <input type="checkbox" id="selectAllCheckbox">
                <label for="selectAllCheckbox">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</label>
                <button class="select-all-btn" id="selectAllBtn">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
                <button class="clear-selection-btn" id="clearSelectionBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
                <span class="selected-count" id="selectedCount">–í—ã–±—Ä–∞–Ω–æ: 0</span>
                <button class="export-btn" id="downloadSelectedApaBtn" style="display: none;">üìÑ APA</button>
                <button class="export-btn" id="downloadSelectedGostBtn" style="display: none;">üìã –ì–û–°–¢</button>
                <button class="export-btn" id="downloadSelectedTxtBtn" style="display: none;">üì• TXT</button>
            </div>
            <div class="results-list" id="resultsList"></div>
        </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü.–í. –ê–ª–µ–∫—Å–µ–µ–≤, –ì–æ—Ä–Ω–æ-–ê–ª—Ç–∞–π—Å–∫–∏–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</p>
            <p class="version-info" id="versionInfo">v1.0.0</p>
        </div>
    </footer>

    <script>
        /**
         * –ú–æ–¥—É–ª—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è Sci-Searcher
         * –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç—Ä–æ–≥—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
         */
        class FilterEngine {
            /**
             * –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≥–æ–¥–æ–≤ (–ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ null)
             */
            static normalizeYear(year) {
                if (!year || year === '' || year === 'undefined' || year === 'null') {
                    return null;
                }
                const yearNum = parseInt(year);
                return isNaN(yearNum) ? null : yearNum;
            }

            /**
             * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥–∞–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ - –°–¢–†–û–ì–ê–Ø —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
             */
            static filterByYear(results, startYear, endYear) {
                const start = this.normalizeYear(startYear);
                const end = this.normalizeYear(endYear);
                
                // –ï—Å–ª–∏ –æ–±–∞ –≥–æ–¥–∞ –Ω–µ —É–∫–∞–∑–∞–Ω—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                if (start === null && end === null) {
                    return results;
                }
                
                console.log(`üîç –°–¢–†–û–ì–ê–Ø —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥–æ–¥–∞–º: ${start || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${end || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);
                
                const originalCount = results.length;
                const filtered = results.filter(work => {
                    const year = work.publication_year;
                    
                    // –ï—Å–ª–∏ –≥–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω –≤ —Ä–∞–±–æ—Ç–µ, –ò–°–ö–õ–Æ–ß–ê–ï–ú –µ—ë –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    if (!year || year === null || year === undefined) {
                        return false;
                    }
                    
                    const workYear = parseInt(year);
                    if (isNaN(workYear)) {
                        return false;
                    }
                    
                    // –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
                    if (start !== null && end !== null) {
                        return workYear >= start && workYear <= end;
                    } else if (start !== null) {
                        return workYear >= start;
                    } else if (end !== null) {
                        return workYear <= end;
                    }
                    
                    return true;
                });
                
                console.log(`‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥–æ–¥–∞–º: ${originalCount} ‚Üí ${filtered.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                
                if (originalCount > filtered.length) {
                    console.log(`‚ö†Ô∏è –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ ${originalCount - filtered.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –≥–æ–¥–æ–≤`);
                }
                
                return filtered;
            }

            /**
             * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø–æ —è–∑—ã–∫—É
             */
            static filterByLanguage(results, language) {
                if (!language || language === 'all') {
                    return results;
                }
                
                const originalCount = results.length;
                const filtered = results.filter(work => {
                    const workLanguage = work.language;
                    if (!workLanguage) {
                        return false;
                    }
                    return workLanguage === language;
                });
                
                console.log(`üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —è–∑—ã–∫—É "${language}": ${originalCount} ‚Üí ${filtered.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                return filtered;
            }

            /**
             * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
             */
            static filterByType(results, filterType) {
                if (!filterType || filterType === 'all') {
                    return results;
                }
                
                const typeMap = {
                    'journals': ['journal-article'],
                    'conferences': ['proceedings-article'],
                    'books': ['book', 'monograph'],
                    'no_repositories': ['journal-article', 'proceedings-article', 'book', 'monograph']
                };
                
                const allowedTypes = typeMap[filterType];
                if (!allowedTypes) {
                    return results;
                }
                
                const originalCount = results.length;
                const filtered = results.filter(work => {
                    const workType = work.type;
                    return workType && allowedTypes.includes(workType);
                });
                
                console.log(`üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É "${filterType}": ${originalCount} ‚Üí ${filtered.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                return filtered;
            }

            /**
             * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø–æ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –¥–æ—Å—Ç—É–ø—É
             */
            static filterByOpenAccess(results, openAccess) {
                if (!openAccess || openAccess === 'all') {
                    return results;
                }
                
                const originalCount = results.length;
                const filtered = results.filter(work => {
                    const isOa = work.is_oa === true;
                    if (openAccess === 'open') {
                        return isOa;
                    } else if (openAccess === 'closed') {
                        return !isOa;
                    }
                    return true;
                });
                
                console.log(`üîç –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–æ—Å—Ç—É–ø—É "${openAccess}": ${originalCount} ‚Üí ${filtered.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                return filtered;
            }

            /**
             * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
             */
            static applySorting(results, sortOrder) {
                if (!sortOrder || sortOrder === 'relevance') {
                    return results;
                }
                
                const sorted = [...results];
                
                if (sortOrder === 'newest') {
                    sorted.sort((a, b) => {
                        const yearA = parseInt(a.publication_year) || 0;
                        const yearB = parseInt(b.publication_year) || 0;
                        return yearB - yearA;
                    });
                } else if (sortOrder === 'oldest') {
                    sorted.sort((a, b) => {
                        const yearA = parseInt(a.publication_year) || 0;
                        const yearB = parseInt(b.publication_year) || 0;
                        return yearA - yearB;
                    });
                }
                
                return sorted;
            }

            /**
             * –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
             */
            static applyAllFilters(results, filters) {
                let filtered = results;
                const originalCount = filtered.length;
                
                filtered = this.filterByYear(filtered, filters.startYear, filters.endYear);
                filtered = this.filterByLanguage(filtered, filters.language);
                filtered = this.filterByType(filtered, filters.filterType);
                filtered = this.filterByOpenAccess(filtered, filters.openAccess);
                filtered = this.applySorting(filtered, filters.sortOrder);
                
                console.log(`‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: ${originalCount} ‚Üí ${filtered.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                return filtered;
            }
        }

        class SciSearcher {
        constructor() {
            console.log('üîß –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ SciSearcher...');
            this.results = [];
            this.currentSource = 'openalex';
            this.selectedResults = new Set();
            this.cache = new Map(); // –ö—ç—à –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
            this.cacheExpiry = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
            this.version = '1.0.0'; // –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è
            this.updateVersionDisplay();
            this.init();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏
        updateVersionDisplay() {
            const versionElement = document.getElementById('versionInfo');
            if (versionElement) {
                versionElement.textContent = `v${this.version}`;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Ä—Å–∏–∏: –±–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –∏–∑ GitHub (–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ push)
        async initVersion() {
            try {
                const cacheKey = 'sci_searcher_commit';
                const cacheTimeKey = 'sci_searcher_commit_checked_at';
                const cacheTtlMs = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API

                const now = Date.now();
                const lastChecked = parseInt(localStorage.getItem(cacheTimeKey) || '0', 10);
                const cached = localStorage.getItem(cacheKey);

                // –ï—Å–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
                if (cached && lastChecked && (now - lastChecked) < cacheTtlMs) {
                    this.version = cached;
                    this.updateVersionDisplay();
                    return;
                }

                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –≤–µ—Ç–∫–∏
                const response = await fetch('https://api.github.com/repos/pavelaleks/Sci-searcher/commits/main', {
                    headers: { 'Accept': 'application/vnd.github+json' }
                });
                if (!response.ok) throw new Error('GitHub API error: ' + response.status);
                const data = await response.json();

                const sha = (data && data.sha) ? String(data.sha) : '';
                const shortSha = sha.substring(0, 7) || 'unknown';
                const commitDateIso = data?.commit?.committer?.date || '';
                const datePart = commitDateIso ? commitDateIso.slice(0, 10).replace(/-/g, '') : '';

                // –§–æ—Ä–º–∞—Ç –≤–µ—Ä—Å–∏–∏: 1.0.<YYYYMMDD>-<shortsha>
                const computedVersion = `1.0.${datePart}-${shortSha}`;

                this.version = computedVersion;
                this.updateVersionDisplay();

                // –ö–µ—à–∏—Ä—É–µ–º
                localStorage.setItem(cacheKey, computedVersion);
                localStorage.setItem(cacheTimeKey, String(now));

                console.log(`Sci-Searcher –≤–µ—Ä—Å–∏—è –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∫–æ–º–º–∏—Ç—É: ${this.version}`);
            } catch (e) {
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∏–∑–≤–µ—Å—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–µ—Ä—Å–∏—é –∏–∑ GitHub, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è:', e?.message || e);
            }
        }

            init() {
                console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SciSearcher...');
                this.initVersion(); // –í–µ—Ä—Å–∏—è –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–æ–≤–æ–º push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
                this.initTheme();
                this.initForms();
                this.initExportButtons();
                this.initSelectionControls();
                this.checkApiStatus();
                console.log('‚úÖ SciSearcher –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
            }

            initTheme() {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
                const themeToggle = document.getElementById('themeToggle');
                if (themeToggle) {
                    themeToggle.addEventListener('click', () => {
                        const currentTheme = document.documentElement.getAttribute('data-theme');
                        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                        document.documentElement.setAttribute('data-theme', newTheme);
                        localStorage.setItem('theme', newTheme);
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
                        themeToggle.style.transform = 'rotate(180deg)';
                        setTimeout(() => {
                            themeToggle.style.transform = 'rotate(0deg)';
                        }, 300);
                    });
                }
            }

            initForms() {
                const openalexForm = document.getElementById('openalexForm');
                if (!openalexForm) {
                    console.error('–§–æ—Ä–º–∞ openalexForm –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                    return;
                }
                
                openalexForm.addEventListener('submit', (e) => this.handleOpenAlexSearch(e));
                console.log('–§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
                const advancedToggle = document.getElementById('advancedToggle');
                const advancedPanel = document.getElementById('advancedPanel');
                
                if (advancedToggle && advancedPanel) {
                    advancedToggle.addEventListener('click', () => {
                        const isActive = advancedPanel.classList.contains('active');
                        if (isActive) {
                            advancedPanel.classList.remove('active');
                            advancedToggle.textContent = '‚öôÔ∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã';
                        } else {
                            advancedPanel.classList.add('active');
                            advancedToggle.textContent = '‚öôÔ∏è –°–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã';
                        }
                    });
                }
            }

            initExportButtons() {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö –∫–Ω–æ–ø–æ–∫
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'downloadApaBtn') {
                        e.preventDefault();
                        this.downloadResults('apa');
                    } else if (e.target.id === 'downloadGostBtn') {
                        e.preventDefault();
                        this.downloadResults('gost');
                    } else if (e.target.id === 'downloadBibtexBtn') {
                        e.preventDefault();
                        this.downloadResults('bibtex');
                    } else if (e.target.id === 'copyBtn') {
                        e.preventDefault();
                        this.copyResults();
                    } else if (e.target.id === 'downloadSelectedApaBtn') {
                        e.preventDefault();
                        this.downloadSelectedResults('apa');
                    } else if (e.target.id === 'downloadSelectedGostBtn') {
                        e.preventDefault();
                        this.downloadSelectedResults('gost');
                    } else if (e.target.id === 'downloadSelectedTxtBtn') {
                        e.preventDefault();
                        this.downloadSelectedResults('txt');
                    }
                });
            }

            initSelectionControls() {
                const selectAllBtn = document.getElementById('selectAllBtn');
                const clearSelectionBtn = document.getElementById('clearSelectionBtn');
                const selectAllCheckbox = document.getElementById('selectAllCheckbox');

                if (selectAllBtn) selectAllBtn.addEventListener('click', () => this.selectAllResults());
                if (clearSelectionBtn) clearSelectionBtn.addEventListener('click', () => this.clearSelection());
                if (selectAllCheckbox) selectAllCheckbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        this.selectAllResults();
                    } else {
                        this.clearSelection();
                    }
                });
            }

            async handleOpenAlexSearch(e) {
                e.preventDefault();
                console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫...');
                
                const keywords = document.getElementById('keywords').value.trim();
                const searchModeElement = document.getElementById('searchMode');
                const searchMode = searchModeElement ? searchModeElement.value : 'simple';
                const startYearElement = document.getElementById('startYear');
                const endYearElement = document.getElementById('endYear');
                let startYear = startYearElement ? (startYearElement.value || '').trim() : '';
                let endYear = endYearElement ? (endYearElement.value || '').trim() : '';
                const resultsLimit = document.getElementById('resultsLimit').value;
                const sortOrder = document.getElementById('sortOrder').value;
                const filterType = document.getElementById('filterType').value;
                const language = document.getElementById('language').value;
                const openAccess = document.getElementById('openAccess').value;

                // –ü—Ä–∏–º–µ–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≥–æ–¥–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –ª–µ—Ç)
                const currentYear = new Date().getFullYear();
                const defaultStartYear = currentYear - 5; // 2020 –¥–ª—è 2025 –≥–æ–¥–∞
                const defaultEndYear = currentYear; // 2025

                if (!startYear || startYear === '') {
                    startYear = defaultStartYear.toString();
                    document.getElementById('startYear').value = startYear;
                    console.log(`üìÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –≥–æ–¥–∞: ${startYear}`);
                }
                
                if (!endYear || endYear === '') {
                    endYear = defaultEndYear.toString();
                    document.getElementById('endYear').value = endYear;
                    console.log(`üìÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–æ–Ω–µ—á–Ω–æ–≥–æ –≥–æ–¥–∞: ${endYear}`);
                }

                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∂–∏–º –ø–æ–∏—Å–∫–∞
                let processedKeywords = keywords;
                if (searchMode === 'exact') {
                    // –¢–æ—á–Ω–∞—è —Ñ—Ä–∞–∑–∞ - –∑–∞–∫–ª—é—á–∞–µ–º –≤ –∫–∞–≤—ã—á–∫–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–∫–ª—é—á–µ–Ω–æ)
                    if (!keywords.startsWith('"') || !keywords.endsWith('"')) {
                        processedKeywords = `"${keywords}"`;
                    } else {
                        processedKeywords = keywords;
                    }
                    console.log(`üîç –†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞: –¢–æ—á–Ω–∞—è —Ñ—Ä–∞–∑–∞ "${processedKeywords}"`);
                } else if (searchMode === 'advanced') {
                    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã AND, OR, NOT
                    // OpenAlex –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±—É–ª–µ–≤—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã: AND, OR, NOT
                    // –ü—Ä–∏–º–µ—Ä—ã: "machine learning" AND "neural networks"
                    // –ü—Ä–∏–º–µ—Ä—ã: "python" OR "javascript"
                    // –ü—Ä–∏–º–µ—Ä—ã: "covid" NOT "vaccine"
                    processedKeywords = keywords;
                    console.log(`üîç –†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AND, OR, NOT)`);
                    console.log(`üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:`);
                    console.log(`   - "machine learning" AND "neural networks"`);
                    console.log(`   - "python" OR "javascript"`);
                    console.log(`   - "covid" NOT "vaccine"`);
                } else {
                    // –ü—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º - –æ–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫, OpenAlex –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç –ø–æ –≤—Å–µ–º —Å–ª–æ–≤–∞–º
                    processedKeywords = keywords;
                    console.log(`üîç –†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞: –ü—Ä–æ—Å—Ç–æ–π (–ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —Å–ª–æ–≤–∞–º)`);
                }

                console.log('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞:', { keywords: processedKeywords, searchMode, startYear, endYear, resultsLimit, sortOrder, filterType, language, openAccess });

                if (!keywords) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                    return;
                }

                this.showLoading();
                
                try {
                    console.log('–í—ã–∑—ã–≤–∞–µ–º searchOpenAlex...');
                    const results = await this.searchOpenAlex(processedKeywords, startYear, endYear, resultsLimit, sortOrder, filterType, language, openAccess);
                    console.log('–ü–æ–ª—É—á–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', results.length);
                    this.displayResults(results);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ:', error);
                    this.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ: ' + error.message);
                }
            }




            async searchOpenAlex(keywords, startYear, endYear, resultsLimit, sortOrder = 'newest', filterType = 'all', language = 'all', openAccess = 'all') {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
                const cacheKey = this.getCacheKey(keywords, startYear, endYear, resultsLimit, sortOrder, filterType, language, openAccess);
                const cachedResults = this.getFromCache(cacheKey);
                if (cachedResults) {
                    return cachedResults;
                }

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å —É—á–µ—Ç–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API
                const perPage = 50; // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º 50 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
                const targetResults = parseInt(resultsLimit);
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–æ–¥–æ–≤
                const currentYear = new Date().getFullYear();
                const minYear = 1700; // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≥–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞
                if (startYear && startYear < minYear) {
                    throw new Error(`–ì–æ–¥ –Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ —Ä–∞–Ω–µ–µ ${minYear}`);
                }
                if (endYear && endYear < minYear) {
                    throw new Error(`–ì–æ–¥ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ —Ä–∞–Ω–µ–µ ${minYear}`);
                }
                if (startYear && endYear && startYear > endYear) {
                    throw new Error('–ì–æ–¥ –Ω–∞—á–∞–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –≥–æ–¥–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è');
                }
                
                // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π URL —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                // –í–ê–ñ–ù–û: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º select –¥–ª—è authorships, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                let baseUrl = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=${perPage}&data_version=2`;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Å–Ω–∞—á–∞–ª–∞ —Å–∞–º—ã–µ –Ω–∞–¥–µ–∂–Ω—ã–µ)
                const filters = [];
                
                // 1. –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –ø—É–±–ª–∏–∫–∞—Ü–∏–π (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
                if (filterType === 'journals') {
                    filters.push('type:journal-article');
                } else if (filterType === 'conferences') {
                    filters.push('type:proceedings-article');
                } else if (filterType === 'books') {
                    filters.push('type:book,monograph');
                } else if (filterType === 'no_repositories') {
                    filters.push('type:journal-article,proceedings-article,book,monograph');
                }
                
                // 2. –§–∏–ª—å—Ç—Ä –ø–æ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –¥–æ—Å—Ç—É–ø—É (–¥–æ–≤–æ–ª—å–Ω–æ –Ω–∞–¥–µ–∂–Ω—ã–π)
                if (openAccess === 'open') {
                    filters.push('is_oa:true');
                } else if (openAccess === 'closed') {
                    filters.push('is_oa:false');
                }
                
                // 3. –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥–∞–º (–º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã)
                if (startYear && endYear) {
                    filters.push(`publication_year:${startYear}-${endYear}`);
                } else if (startYear) {
                    filters.push(`publication_year:>=${startYear}`);
                } else if (endYear) {
                    filters.push(`publication_year:<=${endYear}`);
                }
                
                // 4. –§–∏–ª—å—Ç—Ä –ø–æ —è–∑—ã–∫—É (–º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã)
                if (language !== 'all') {
                    filters.push(`language:${language}`);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –∫ URL
                if (filters.length > 0) {
                    baseUrl += `&filter=${filters.join(',')}`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
                switch(sortOrder) {
                    case 'oldest':
                        baseUrl += '&sort=publication_date:asc';
                        break;
                    case 'relevance':
                        baseUrl += '&sort=relevance_score:desc';
                        break;
                    case 'newest':
                    default:
                        baseUrl += '&sort=publication_date:desc';
                        break;
                }
                
                let url = baseUrl;

                console.log('OpenAlex API URL:', url);
                console.log('Search parameters:', { keywords, startYear, endYear, resultsLimit });
                console.log('Year filters applied:', { startYear, endYear, hasFilters: !!(startYear || endYear) });
                console.log('Using OpenAlex data_version=2 (improved metadata quality)');

                try {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—Ä–æ—Å–æ–º –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è rate limiting
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                        }
                    });
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
                    if (response.ok) {
                        // –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                        const data = await response.json();
                        console.log('OpenAlex API response:', data);
                        console.log('Total results found:', data.meta?.count || 0);
                        
                        let results = data.results || [];
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
                        if (results.length > 0) {
                            const appliedFilters = [];
                            if (filterType !== 'all') appliedFilters.push(`—Ç–∏–ø—É "${filterType}"`);
                            if (language !== 'all') appliedFilters.push(`—è–∑—ã–∫—É "${language}"`);
                            if (openAccess !== 'all') appliedFilters.push(`–¥–æ—Å—Ç—É–ø—É "${openAccess}"`);
                            if (startYear || endYear) appliedFilters.push(`–≥–æ–¥–∞–º ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}-${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);
                            
                            if (appliedFilters.length > 0) {
                                results[0]._info = `‚úÖ –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø–æ ${appliedFilters.join(', ')}. –ù–∞–π–¥–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.`;
                            }
                        }
                        
                        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                        if (targetResults > 50 && data.meta && data.meta.count > perPage) {
                            const totalCount = Math.min(data.meta.count, targetResults);
                            const totalPages = Math.ceil(totalCount / perPage);
                            const maxPages = Math.min(totalPages, 5);
                            
                            console.log(`–ù–∞–π–¥–µ–Ω–æ ${totalCount} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –¥–µ–ª–∞–µ–º ${maxPages} –∑–∞–ø—Ä–æ—Å–æ–≤`);
                            
                            const updateProgress = (page, total) => {
                                const resultsList = document.getElementById('resultsList');
                                if (resultsList) {
                                    const progress = Math.round((page / total) * 100);
                                    resultsList.innerHTML = `
                                        <div class="loading">
                                            <div class="spinner"></div>
                                            <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤... –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${page} –∏–∑ ${total}</div>
                                            <div style="margin-top: 10px; width: 200px; background: #e0e0e0; border-radius: 10px; overflow: hidden; margin: 10px auto;">
                                                <div style="width: ${progress}%; height: 20px; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.3s;"></div>
                                            </div>
                                        </div>
                                    `;
                                }
                            };
                            
                            for (let page = 2; page <= maxPages; page++) {
                                try {
                                    updateProgress(page, maxPages);
                                    await new Promise(resolve => setTimeout(resolve, 600));
                                    
                                    const pageUrl = url + `&page=${page}`;
                                    console.log(`–ó–∞–ø—Ä–æ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, pageUrl);
                                    
                                    const pageResponse = await fetch(pageUrl);
                                    
                                    if (!pageResponse.ok) {
                                        console.warn(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, pageResponse.status);
                                    break;
                                    }
                                    
                                    const pageData = await pageResponse.json();
                                    results = results.concat(pageData.results || []);
                                    
                                    console.log(`–ü–æ–ª—É—á–µ–Ω–æ ${pageData.results?.length || 0} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}. –í—Å–µ–≥–æ: ${results.length}`);
                                    
                                } catch (error) {
                                    console.warn(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, error.message);
                                    break;
                                }
                            }
                        }
                        
                        // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç—Ä–æ–≥—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –Ω–∞ –í–°–ï–• —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
                        // API –º–æ–∂–µ—Ç –Ω–µ –≤—Å–µ–≥–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ –≥–æ–¥–∞–º
                        if (Array.isArray(results) && results.length > 0) {
                            console.log(`üîç –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç—Ä–æ–≥—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∫ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º`);
                            try {
                                if (typeof FilterEngine !== 'undefined' && FilterEngine.applyAllFilters) {
                                    const filters = {
                                        startYear: startYear,
                                        endYear: endYear,
                                        language: language,
                                        filterType: filterType,
                                        openAccess: openAccess,
                                        sortOrder: sortOrder
                                    };
                                    results = FilterEngine.applyAllFilters(results, filters);
                                    console.log(`‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞, –æ—Å—Ç–∞–ª–æ—Å—å ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                                } else {
                                    console.error('‚ùå FilterEngine –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!');
                                }
                            } catch (filterError) {
                                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', filterError);
                                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –Ω–µ–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
                            }
                        }
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫—ç—à
                        this.setCache(cacheKey, results);
                        
                        return results;
                        
                    } else {
                        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
                        console.log(`–û—à–∏–±–∫–∞ ${response.status} —Å –ø–æ–ª–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –ø—Ä–æ–±—É–µ–º –ø–æ—ç—Ç–∞–ø–Ω—ã–π fallback...`);
                        
                        // –≠—Ç–∞–ø 1: –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (—è–∑—ã–∫ –∏ –≥–æ–¥—ã)
                        let fallbackUrl = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=${perPage}&data_version=2`;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞–¥–µ–∂–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
                        const safeFilters = [];
                            if (filterType === 'journals') {
                            safeFilters.push('type:journal-article');
                            } else if (filterType === 'conferences') {
                            safeFilters.push('type:proceedings-article');
                            } else if (filterType === 'books') {
                            safeFilters.push('type:book,monograph');
                            } else if (filterType === 'no_repositories') {
                            safeFilters.push('type:journal-article,proceedings-article,book,monograph');
                            }
                            
                            if (openAccess === 'open') {
                            safeFilters.push('is_oa:true');
                            } else if (openAccess === 'closed') {
                            safeFilters.push('is_oa:false');
                        }
                        
                        if (safeFilters.length > 0) {
                            fallbackUrl += `&filter=${safeFilters.join(',')}`;
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
                        switch(sortOrder) {
                            case 'oldest':
                                fallbackUrl += '&sort=publication_date:asc';
                                break;
                            case 'relevance':
                                fallbackUrl += '&sort=relevance_score:desc';
                                break;
                            case 'newest':
                            default:
                                fallbackUrl += '&sort=publication_date:desc';
                                break;
                        }
                        
                        console.log('Fallback URL (–±–µ–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤):', fallbackUrl);
                            
                            const fallbackResponse = await fetch(fallbackUrl, {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json',
                                    'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                                }
                            });
                            
                            if (fallbackResponse.ok) {
                                const fallbackData = await fallbackResponse.json();
                                let results = fallbackData.results || [];
                                
                            console.log(`Fallback —É—Å–ø–µ—à–µ–Ω, –ø–æ–ª—É—á–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                            
                            // –ü—Ä–∏–º–µ–Ω—è–µ–º –°–¢–†–û–ì–£–Æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ FilterEngine
                            const originalCount = results.length;
                            if (Array.isArray(results) && results.length > 0) {
                                try {
                                    if (typeof FilterEngine !== 'undefined' && FilterEngine.applyAllFilters) {
                                        const filters = {
                                            startYear: startYear,
                                            endYear: endYear,
                                            language: language,
                                            filterType: filterType,
                                            openAccess: openAccess,
                                            sortOrder: sortOrder
                                        };
                                        results = FilterEngine.applyAllFilters(results, filters);
                                        console.log(`‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: ${originalCount} ‚Üí ${results.length}`);
                                    }
                                } catch (filterError) {
                                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', filterError);
                                }
                            }
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
                            if (results.length > 0 && (language !== 'all' || startYear || endYear)) {
                                const warnings = [];
                                if (language !== 'all') warnings.push(`—è–∑—ã–∫—É "${language}"`);
                                if (startYear || endYear) warnings.push(`–≥–æ–¥–∞–º ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}-${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);
                                
                                results[0]._info = `‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ ${warnings.join(' –∏ ')}. –ü–æ–∫–∞–∑–∞–Ω–æ ${results.length} –∏–∑ ${originalCount} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.`;
                                }
                                
                                return results;
                            } else {
                            // –≠—Ç–∞–ø 2: –ï—Å–ª–∏ –∏ fallback –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
                            console.warn(`Fallback —Ç–∞–∫–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (${fallbackResponse.status}), –ø—Ä–æ–±—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å...`);
                                
                            const minimalUrl = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=25&data_version=2`;
                                
                                try {
                                const minimalResponse = await fetch(minimalUrl, {
                                        method: 'GET',
                                        headers: {
                                            'Accept': 'application/json',
                                            'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                                        }
                                    });
                                    
                                if (minimalResponse.ok) {
                                    const minimalData = await minimalResponse.json();
                                    let results = minimalData.results || [];
                                    
                                    console.log(`–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω, –ø–æ–ª—É—á–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                                    
                                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –°–¢–†–û–ì–£–Æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ FilterEngine
                                    const originalCount = results.length;
                                    if (Array.isArray(results) && results.length > 0) {
                                        try {
                                            if (typeof FilterEngine !== 'undefined' && FilterEngine.applyAllFilters) {
                                                const filters = {
                                                    startYear: startYear,
                                                    endYear: endYear,
                                                    language: language,
                                                    filterType: filterType,
                                                    openAccess: openAccess,
                                                    sortOrder: sortOrder
                                                };
                                                results = FilterEngine.applyAllFilters(results, filters);
                                                console.log(`‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: ${originalCount} ‚Üí ${results.length}`);
                                            }
                                        } catch (filterError) {
                                            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', filterError);
                                        }
                                    }
                                    
                                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                                    if (results.length > 0) {
                                        results[0]._info = `‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ç—Ä–æ–≥–∞—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è. –ü–æ–∫–∞–∑–∞–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ ${originalCount}.`;
                                    }
                                    
                                    return results;
                                }
                            } catch (minimalError) {
                                console.warn('–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Ç–∞–∫–∂–µ –Ω–µ —É–¥–∞–ª—Å—è:', minimalError);
                                }
                                
                                // –ï—Å–ª–∏ –≤—Å–µ –º–µ—Ç–æ–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                                throw new Error('OpenAlex API –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å:\n\n' +
                                    '‚Ä¢ –í—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ —Å–µ—Ä–≤–∏—Å–∞\n' +
                                    '‚Ä¢ –í—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä\n' +
                                    '‚Ä¢ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ —Ä–∞–±–æ—Ç–∞–º–∏\n\n' +
                                    '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\n' +
                                    '‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç\n' +
                                    '‚Ä¢ –£–ø—Ä–æ—Å—Ç–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å\n' +
                                    '‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ');
                            }
                            
                            // –ï—Å–ª–∏ fallback –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –æ—à–∏–±–æ–∫
                            if (response.status === 429) {
                                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 429 (–ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤)
                            console.warn('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (429), –ø—Ä–æ–±—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å...');
                            
                                const limitedUrl = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=10&data_version=2`;
                            
                            try {
                                const limitedResponse = await fetch(limitedUrl, {
                                    method: 'GET',
                                    headers: {
                                        'Accept': 'application/json',
                                        'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                                    }
                                });
                                
                                if (limitedResponse.ok) {
                                    const limitedData = await limitedResponse.json();
                                        let results = limitedData.results || [];
                                        
                                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –°–¢–†–û–ì–£–Æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ FilterEngine
                                        if (Array.isArray(results) && results.length > 0) {
                                            try {
                                                if (typeof FilterEngine !== 'undefined' && FilterEngine.applyAllFilters) {
                                                    const filters = {
                                                        startYear: startYear,
                                                        endYear: endYear,
                                                        language: language,
                                                        filterType: filterType,
                                                        openAccess: openAccess,
                                                        sortOrder: sortOrder
                                                    };
                                                    results = FilterEngine.applyAllFilters(results, filters);
                                                }
                                            } catch (filterError) {
                                                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', filterError);
                                            }
                                        }
                                        
                                        console.log('–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω, –ø–æ–ª—É—á–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', results.length);
                                        return results;
                                }
                            } catch (limitedError) {
                                console.warn('–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Ç–∞–∫–∂–µ –Ω–µ —É–¥–∞–ª—Å—è:', limitedError);
                            }
                            
                            throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenAlex API. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å.');
                        } else if (response.status === 400) {
                            throw new Error('–û—à–∏–±–∫–∞ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø–æ–∏—Å–∫–∞. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n\n' +
                                '‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞\n' +
                                '‚Ä¢ –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤–∞—Ö\n' +
                                '‚Ä¢ –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã\n\n' +
                                '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n' +
                                '‚Ä¢ –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å\n' +
                                '‚Ä¢ –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã\n' +
                                '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
                        } else {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    }
                } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ OpenAlex:', error);
                
                // –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ - —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
                if (error.message.includes('OpenAlex API –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω') || 
                    error.message.includes('Failed to fetch') || 
                    error.name === 'TypeError') {
                    
                    console.log('üîÑ –ü—Ä–æ–±—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π fallback - —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å...');
                    
                    try {
                        const simplestUrl = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=10&data_version=2`;
                        
                        console.log('–ü—Ä–æ—Å—Ç–µ–π—à–∏–π URL:', simplestUrl);
                        
                        const simplestResponse = await fetch(simplestUrl, {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json',
                                    'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                                }
                            });
                            
                        if (simplestResponse.ok) {
                            const simplestData = await simplestResponse.json();
                            let simpleResults = simplestData.results || [];
                            
                            console.log(`‚úÖ –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω, –ø–æ–ª—É—á–µ–Ω–æ ${simpleResults.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                            
                            // –ü—Ä–∏–º–µ–Ω—è–µ–º –°–¢–†–û–ì–£–Æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ FilterEngine
                            const originalCount = simpleResults.length;
                            if (Array.isArray(simpleResults) && simpleResults.length > 0) {
                                try {
                                    if (typeof FilterEngine !== 'undefined' && FilterEngine.applyAllFilters) {
                                        const filters = {
                                            startYear: startYear,
                                            endYear: endYear,
                                            language: language,
                                            filterType: filterType,
                                            openAccess: openAccess,
                                            sortOrder: sortOrder
                                        };
                                        simpleResults = FilterEngine.applyAllFilters(simpleResults, filters);
                                        console.log(`‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: ${originalCount} ‚Üí ${simpleResults.length}`);
                                    }
                                } catch (filterError) {
                                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', filterError);
                                }
                            }
                            
                            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                            simpleResults = simpleResults.slice(0, targetResults);
                            
                            console.log(`–ü–æ—Å–ª–µ —Å—Ç—Ä–æ–≥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: ${originalCount} ‚Üí ${simpleResults.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                            if (simpleResults.length > 0) {
                                simpleResults[0]._info = `‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ç—Ä–æ–≥–∞—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (fallback —Ä–µ–∂–∏–º). –ü–æ–∫–∞–∑–∞–Ω–æ ${simpleResults.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ ${originalCount}.`;
                            }
                            
                            return simpleResults;
                        } else {
                            console.error(`–ü—Ä–æ—Å—Ç–µ–π—à–∏–π –∑–∞–ø—Ä–æ—Å —Ç–∞–∫–∂–µ –Ω–µ —É–¥–∞–ª—Å—è: ${simplestResponse.status}`);
                        }
                    } catch (simpleError) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ—Å—Ç–µ–π—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:', simpleError);
                    }
                }
                
                // –ï—Å–ª–∏ –≤—Å–µ –º–µ—Ç–æ–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
                    if (error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n\n' +
                            '‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º\n' +
                            '‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ CORS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞\n' +
                            '‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–æ–º –∏–ª–∏ —Ñ–∞–π—Ä–≤–æ–ª–æ–º\n' +
                            '‚Ä¢ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å OpenAlex —Å–µ—Ä–≤–µ—Ä–æ–º\n\n' +
                            '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n' +
                            '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n' +
                            '‚Ä¢ –û—Ç–∫–ª—é—á–∏—Ç—å VPN –∏–ª–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å –≤—Ä–µ–º–µ–Ω–Ω–æ\n' +
                            '‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä\n' +
                            '‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É: pavel.alekseev.gasu@gmail.com');
                    }
                    
                    throw error;
                }
            }








            displayResults(results) {
                this.results = results;
                this.selectedResults.clear();
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                const resultsCount = document.getElementById('resultsCount');
                const selectionControls = document.getElementById('selectionControls');

                resultsPanel.style.display = 'block';
                resultsPanel.classList.add('active');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
                let countText = `–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${results.length}`;
                resultsCount.textContent = countText;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–±–æ—Ä–æ–º
                if (selectionControls) {
                    selectionControls.style.display = 'flex';
                }

                if (results.length === 0) {
                    resultsList.innerHTML = '<div class="no-results">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.</div>';
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
                let infoHtml = '';
                if (results.length > 0) {
                    if (results[0]._info) {
                        infoHtml = `<div class="info" style="margin-bottom: 15px; background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; border-radius: 8px; padding: 12px;">
                            <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> ${results[0]._info}
                        </div>`;
                    } else if (results[0]._warning) {
                        infoHtml = `<div class="warning" style="margin-bottom: 15px; background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; border-radius: 8px; padding: 12px;">
                        <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> ${results[0]._warning}
                    </div>`;
                    }
                }

                try {
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–∑—É
                    resultsList.innerHTML = infoHtml + results.map((work, index) => this.formatResult(work, index + 1)).join('');
                    this.updateSelectionCount();
                    this.generateAnalytics(results);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                    console.error('–ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', results.find((work, index) => {
                        try {
                            this.formatResult(work, index + 1);
                            return false;
                        } catch (e) {
                            console.error(`–û—à–∏–±–∫–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ ${index + 1}:`, e);
                            return true;
                        }
                    }));
                    
                    resultsList.innerHTML = infoHtml + '<div class="error">–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.</div>';
                }
            }

            generateAnalytics(results) {
                if (results.length === 0) return;
                
                const analyticsPanel = document.getElementById('analyticsPanel');
                analyticsPanel.style.display = 'block';
                
                // –ê–Ω–∞–ª–∏–∑ –∞–≤—Ç–æ—Ä–æ–≤
                const authors = {};
                results.forEach(work => {
                    work.authorships?.forEach(authorship => {
                        const authorName = authorship?.author?.display_name;
                        if (authorName) {
                            authors[authorName] = (authors[authorName] || 0) + 1;
                        }
                    });
                });
                
                const topAuthors = Object.entries(authors)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);
                
                document.getElementById('topAuthors').innerHTML = topAuthors
                    .map(([name, count]) => `
                        <div class="analytics-item">
                            <span>${name}</span>
                            <span>${count}</span>
                        </div>
                        <div class="analytics-bar">
                            <div class="analytics-bar-fill" style="width: ${(count / topAuthors[0][1]) * 100}%"></div>
                        </div>
                    `).join('');
                
                // –ê–Ω–∞–ª–∏–∑ –∂—É—Ä–Ω–∞–ª–æ–≤
                const journals = {};
                results.forEach(work => {
                    const journalName = work.primary_location?.source?.display_name;
                    if (journalName) {
                        journals[journalName] = (journals[journalName] || 0) + 1;
                    }
                });
                
                const topJournals = Object.entries(journals)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);
                
                document.getElementById('topJournals').innerHTML = topJournals
                    .map(([name, count]) => `
                        <div class="analytics-item">
                            <span>${name.length > 30 ? name.substring(0, 30) + '...' : name}</span>
                            <span>${count}</span>
                        </div>
                        <div class="analytics-bar">
                            <div class="analytics-bar-fill" style="width: ${(count / topJournals[0][1]) * 100}%"></div>
                        </div>
                    `).join('');
                
                // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–æ–¥–∞–º
                const years = {};
                results.forEach(work => {
                    const year = work.publication_year;
                    if (year) {
                        years[year] = (years[year] || 0) + 1;
                    }
                });
                
                const sortedYears = Object.entries(years)
                    .sort(([a], [b]) => b - a)
                    .slice(0, 5);
                
                document.getElementById('yearDistribution').innerHTML = sortedYears
                    .map(([year, count]) => `
                        <div class="analytics-item">
                            <span>${year}</span>
                            <span>${count}</span>
                        </div>
                        <div class="analytics-bar">
                            <div class="analytics-bar-fill" style="width: ${(count / sortedYears[0][1]) * 100}%"></div>
                        </div>
                    `).join('');
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
                const openAccessCount = results.filter(work => work.open_access?.is_oa).length;
                const totalCount = results.length;
                const openAccessPercent = Math.round((openAccessCount / totalCount) * 100);
                
                // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                console.log('=== –ê–ù–ê–õ–ò–ó –û–¢–ö–†–´–¢–û–ì–û –î–û–°–¢–£–ü–ê ===');
                console.log(`–í—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${totalCount}`);
                console.log(`–û—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø: ${openAccessCount} (${openAccessPercent}%)`);
                console.log(`–ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø: ${totalCount - openAccessCount} (${100 - openAccessPercent}%)`);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–æ—Å—Ç—É–ø–∞
                const openAccessExamples = results.filter(work => work.open_access?.is_oa).slice(0, 3);
                const closedAccessExamples = results.filter(work => !work.open_access?.is_oa).slice(0, 3);
                
                console.log('–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:', openAccessExamples.map(w => ({
                    title: w.title?.substring(0, 50) + '...',
                    is_oa: w.open_access?.is_oa,
                    oa_url: w.open_access?.oa_url,
                    oa_status: w.open_access?.oa_status
                })));
                
                console.log('–ü—Ä–∏–º–µ—Ä—ã –ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:', closedAccessExamples.map(w => ({
                    title: w.title?.substring(0, 50) + '...',
                    is_oa: w.open_access?.is_oa,
                    oa_url: w.open_access?.oa_url,
                    oa_status: w.open_access?.oa_status
                })));
                
                console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–¢–ö–†–´–¢–û–ì–û –î–û–°–¢–£–ü–ê ===');
                
                document.getElementById('openAccessStats').innerHTML = `
                    <div class="analytics-item">
                        <span>–û—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø</span>
                        <span>${openAccessCount} (${openAccessPercent}%)</span>
                    </div>
                    <div class="analytics-bar">
                        <div class="analytics-bar-fill" style="width: ${openAccessPercent}%"></div>
                    </div>
                    <div class="analytics-item">
                        <span>–ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø</span>
                        <span>${totalCount - openAccessCount} (${100 - openAccessPercent}%)</span>
                    </div>
                    <div class="analytics-bar">
                        <div class="analytics-bar-fill" style="width: ${100 - openAccessPercent}%; background: var(--accent-secondary);"></div>
                    </div>
                `;
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è HTML-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
            sanitizeHtml(html) {
                if (!html) return '';
                
                // –ü—Ä–æ—Å—Ç–∞—è –æ—á–∏—Å—Ç–∫–∞ HTML - —É–¥–∞–ª—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ —Ç–µ–≥–∏
                // –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–µ–≥–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                let cleanedHtml = html
                    // –£–¥–∞–ª—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ —Ç–µ–≥–∏
                    .replace(/<script[^>]*>.*?<\/script>/gi, '')
                    .replace(/<iframe[^>]*>.*?<\/iframe>/gi, '')
                    .replace(/<object[^>]*>.*?<\/object>/gi, '')
                    .replace(/<embed[^>]*>.*?<\/embed>/gi, '')
                    .replace(/<link[^>]*>/gi, '')
                    .replace(/<meta[^>]*>/gi, '')
                    .replace(/<style[^>]*>.*?<\/style>/gi, '')
                    // –£–¥–∞–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã onclick, onload –∏ –¥—Ä—É–≥–∏–µ —Å–æ–±—ã—Ç–∏—è
                    .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
                    // –£–¥–∞–ª—è–µ–º javascript: —Å—Å—ã–ª–∫–∏
                    .replace(/javascript:/gi, '')
                    // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ —Ç–µ–≥–∏
                    .replace(/<(\w+)[^>]*>\s*<\/\1>/gi, '')
                    // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã
                    .replace(/<p[^>]*>\s*<\/p>/gi, '')
                    // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ span'—ã
                    .replace(/<span[^>]*>\s*<\/span>/gi, '');
                
                // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø—É—Å—Ç—ã–µ —Ç–µ–≥–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç –±–µ–∑ —Ç–µ–≥–æ–≤
                const textOnly = cleanedHtml.replace(/<[^>]*>/g, '').trim();
                if (textOnly.length === 0) {
                    return '';
                }
                
                return cleanedHtml;
            }

            formatResult(work, index) {
                console.log(`\n=== FORMATTING RESULT ${index} ===`);
                console.log('Work object:', work);
                console.log('Work keys:', Object.keys(work));
                console.log('Biblio data:', work.biblio);
                console.log('Page info:', {
                    first_page: work.biblio?.first_page,
                    last_page: work.biblio?.last_page,
                    pages: work.pages
                });
                console.log('Authorships:', work.authorships);
                console.log('Primary location:', work.primary_location);
                
                const title = work.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                
                console.log('=== –û–¢–õ–ê–î–ö–ê –ê–í–¢–û–†–û–í ===');
                console.log('Work data for authors:', work);
                console.log('Authorships:', work.authorships);
                console.log('Authorships type:', typeof work.authorships);
                console.log('Authorships is array:', Array.isArray(work.authorships));
                console.log('Authorships length:', work.authorships?.length);
                
                if (work.authorships && work.authorships.length > 0) {
                    console.log('First authorship:', work.authorships[0]);
                    console.log('First authorship keys:', Object.keys(work.authorships[0]));
                    console.log('First authorship author:', work.authorships[0].author);
                    if (work.authorships[0].author) {
                        console.log('First author keys:', Object.keys(work.authorships[0].author));
                        console.log('First author display_name:', work.authorships[0].author.display_name);
                    }
                }
                
                console.log('Work.authors:', work.authors);
                console.log('Work.author:', work.author);
                console.log('All work keys:', Object.keys(work));
                
                let authors = '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                
                // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
                if (work.authorships && Array.isArray(work.authorships) && work.authorships.length > 0) {
                    const authorNames = work.authorships
                        .map(authorship => {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ –∫ –∏–º–µ–Ω–∏ –∞–≤—Ç–æ—Ä–∞
                            if (authorship?.author) {
                                return authorship.author.display_name || 
                                       authorship.author.name ||
                                       authorship.author.title ||
                                       (authorship.author.display_name_alternatives && authorship.author.display_name_alternatives[0]) ||
                                       authorship.author.id?.split('/').pop(); // fallback –Ω–∞ ID
                            }
                            // –ï—Å–ª–∏ author - —ç—Ç–æ –æ–±—ä–µ–∫—Ç –Ω–∞–ø—Ä—è–º—É—é
                            return authorship?.display_name || 
                                   authorship?.name ||
                                   authorship?.title ||
                                   authorship?.display_name_alternatives?.[0];
                        })
                        .filter(name => name && name.trim() !== '');
                    
                    if (authorNames.length > 0) {
                        authors = authorNames.join(', ');
                    }
                } 
                
                // –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã —á–µ—Ä–µ–∑ authorships, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                if (authors === '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã') {
                    if (work.authors && Array.isArray(work.authors) && work.authors.length > 0) {
                    const authorNames = work.authors
                            .map(author => {
                                if (typeof author === 'string') return author;
                                return author?.display_name || author?.name || author?.title || author?.id?.split('/').pop();
                            })
                        .filter(name => name && name.trim() !== '');
                    
                    if (authorNames.length > 0) {
                        authors = authorNames.join(', ');
                    }
                } else if (work.author) {
                    // –ï–¥–∏–Ω–∏—á–Ω—ã–π –∞–≤—Ç–æ—Ä
                        if (typeof work.author === 'string') {
                            authors = work.author;
                } else {
                            authors = work.author.display_name || 
                                     work.author.name || 
                                     work.author.title || 
                                     work.author.id?.split('/').pop() ||
                                     '–ê–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω';
                        }
                    } else {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ª—è –∏–∑ API OpenAlex
                    const possibleAuthorFields = [
                            'concepts', // –∏–Ω–æ–≥–¥–∞ –∞–≤—Ç–æ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤ concepts
                            'mesh', // –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–æ–≤
                        ];
                        
                        // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤ primary_location
                        if (work.primary_location?.source?.host_organization_name) {
                            // –≠—Ç–æ –Ω–µ –∞–≤—Ç–æ—Ä, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ locations
                        if (work.locations && Array.isArray(work.locations)) {
                            const locationAuthors = work.locations
                                .map(loc => loc?.source?.display_name)
                                .filter(name => name && name.trim() !== '');
                            
                            if (locationAuthors.length === 0 && work.authorships) {
                                // –ï—Å–ª–∏ authorships –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤, –∑–Ω–∞—á–∏—Ç –∞–≤—Ç–æ—Ä—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ —É–∫–∞–∑–∞–Ω—ã
                                console.log('authorships —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ø—É—Å—Ç–æ–π - –∞–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ API');
                            }
                        }
                    }
                }
                
                // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ—Ç –∞–≤—Ç–æ—Ä–æ–≤, –ø—ã—Ç–∞–µ–º—Å—è –¥–æ—Å—Ç–∞—Ç—å –∏–∑ –ª—é–±–æ–≥–æ –º–µ—Å—Ç–∞
                if (authors === '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã' && work.authorships && work.authorships.length === 0) {
                    console.warn('authorships –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ - –∞–≤—Ç–æ—Ä—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ API OpenAlex');
                }
                
                console.log('Final authors:', authors);
                const journal = work.primary_location?.source?.display_name || '–ñ—É—Ä–Ω–∞–ª –Ω–µ —É–∫–∞–∑–∞–Ω';
                const year = work.publication_year || '–ì–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω';
                    
                    // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
                    console.log('Abstract fields available:', {
                        'abstract_inverted_index': work.abstract_inverted_index,
                        'abstract': work.abstract,
                        'description': work.description,
                        'summary': work.summary
                    });
                    
                let abstract;
                    if (work.abstract_inverted_index) {
                        abstract = this.reconstructAbstract(work.abstract_inverted_index);
                        console.log('Reconstructed abstract length:', abstract.length);
                    } else if (work.abstract) {
                        abstract = work.abstract;
                        console.log('Direct abstract length:', abstract.length);
                    } else if (work.description) {
                        abstract = work.description;
                        console.log('Description used as abstract, length:', abstract.length);
                    } else if (work.summary) {
                        abstract = work.summary;
                        console.log('Summary used as abstract, length:', abstract.length);
                    } else {
                        abstract = '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                        console.log('No abstract found');
                    }
                    
                const doi = work.doi;
                const linkUrl = work.landing_page_url || work.id || '#';

                const resultIndex = index - 1;
                
                return `
                    <div class="result-item" data-index="${resultIndex}">
                            <input type="checkbox" class="result-checkbox" data-index="${resultIndex}" onchange="window.sciSearcher.toggleSelection(${resultIndex})">
                        <div class="result-title">${title}</div>
                        <div class="result-authors">${authors}</div>
                        <div class="result-journal">${journal}</div>
                        <div class="result-year">–ì–æ–¥: ${year}</div>
                        ${work.biblio?.first_page ? `
                            <div class="result-pages" style="color: #27ae60; font-size: 0.8rem; margin-bottom: 6px;">
                                üìÑ –°—Ç—Ä–∞–Ω–∏—Ü—ã: ${work.biblio.first_page}${work.biblio.last_page && work.biblio.first_page !== work.biblio.last_page ? `‚Äì${work.biblio.last_page}` : ''}
                            </div>
                        ` : work.biblio?.volume ? `
                            <div class="result-pages" style="color: #f39c12; font-size: 0.8rem; margin-bottom: 6px;">
                                üìñ –¢–æ–º ${work.biblio.volume}${work.biblio.issue ? `, ‚Ññ ${work.biblio.issue}` : ''} (—Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã)
                            </div>
                        ` : ''}
                        ${abstract && abstract !== '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞' ? `
                            <div class="result-abstract abstract-preview" id="abstract-${resultIndex}">
                                ${this.sanitizeHtml(abstract)}
                            </div>
                                <button class="toggle-abstract" onclick="window.sciSearcher.toggleAbstract(${resultIndex})">
                                    –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
                                </button>
                        ` : ''}
                        ${doi ? `<div class="result-doi">DOI: <a href="${doi.startsWith('https://doi.org/') ? doi : `https://doi.org/${doi}`}" target="_blank">${doi.replace('https://doi.org/', '')}</a></div>` : ''}
                        <a href="${linkUrl}" target="_blank" class="result-link">
                            üîó –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å—Ç–∞—Ç—å–µ
                        </a>
                    </div>
                `;
            }

            reconstructAbstract(abstractIndex) {
                if (!abstractIndex) return '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                
                console.log('Reconstructing abstract from index:', abstractIndex);
                
                try {
                    const words = [];
                    for (const [word, positions] of Object.entries(abstractIndex)) {
                        if (Array.isArray(positions)) {
                            positions.forEach(pos => {
                                words[pos] = word;
                            });
                        }
                    }
                    
                    // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—É—Å—Ç—ã–µ —Å–ª–æ—Ç—ã –∏ —Å–æ–µ–¥–∏–Ω—è–µ–º —Å–ª–æ–≤–∞
                    const fullText = words.filter(word => word !== undefined).join(' ');
                    console.log('Reconstructed abstract full text length:', fullText.length);
                    console.log('First 200 chars:', fullText.substring(0, 200));
                    
                    return fullText || '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                } catch (error) {
                    console.error('Error reconstructing abstract:', error);
                    return '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏';
                }
            }

            toggleSelection(index) {
                const checkbox = document.querySelector(`input[data-index="${index}"]`);
                const resultItem = document.querySelector(`.result-item[data-index="${index}"]`);
                
                if (checkbox.checked) {
                    this.selectedResults.add(index);
                    resultItem.classList.add('selected');
                } else {
                    this.selectedResults.delete(index);
                    resultItem.classList.remove('selected');
                }
                
                this.updateSelectionCount();
            }

            toggleAbstract(index) {
                const abstractElement = document.getElementById(`abstract-${index}`);
                const button = document.querySelector(`button[onclick="window.sciSearcher.toggleAbstract(${index})"]`);
                
                if (abstractElement.classList.contains('abstract-preview')) {
                    abstractElement.classList.remove('abstract-preview');
                    abstractElement.classList.add('abstract-full');
                    button.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å';
                } else {
                    abstractElement.classList.remove('abstract-full');
                    abstractElement.classList.add('abstract-preview');
                    button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é';
                }
            }

            selectAllResults() {
                this.selectedResults.clear();
                const checkboxes = document.querySelectorAll('.result-checkbox');
                const resultItems = document.querySelectorAll('.result-item');
                
                checkboxes.forEach((checkbox, index) => {
                    checkbox.checked = true;
                    this.selectedResults.add(index);
                    resultItems[index].classList.add('selected');
                });
                
                this.updateSelectionCount();
            }

            clearSelection() {
                this.selectedResults.clear();
                const checkboxes = document.querySelectorAll('.result-checkbox');
                const resultItems = document.querySelectorAll('.result-item');
                
                checkboxes.forEach((checkbox, index) => {
                    checkbox.checked = false;
                    resultItems[index].classList.remove('selected');
                });
                
                this.updateSelectionCount();
            }

            updateSelectionCount() {
                const selectedCount = document.getElementById('selectedCount');
                const selectAllCheckbox = document.getElementById('selectAllCheckbox');
                const downloadSelectedApaBtn = document.getElementById('downloadSelectedApaBtn');
                const downloadSelectedGostBtn = document.getElementById('downloadSelectedGostBtn');
                const downloadSelectedTxtBtn = document.getElementById('downloadSelectedTxtBtn');
                
                if (selectedCount) {
                    selectedCount.textContent = `–í—ã–±—Ä–∞–Ω–æ: ${this.selectedResults.size}`;
                }
                
                if (selectAllCheckbox) {
                    selectAllCheckbox.checked = this.selectedResults.size === this.results.length && this.results.length > 0;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
                const hasSelected = this.selectedResults.size > 0;
                if (downloadSelectedApaBtn) downloadSelectedApaBtn.style.display = hasSelected ? 'flex' : 'none';
                if (downloadSelectedGostBtn) downloadSelectedGostBtn.style.display = hasSelected ? 'flex' : 'none';
                if (downloadSelectedTxtBtn) downloadSelectedTxtBtn.style.display = hasSelected ? 'flex' : 'none';
            }

            downloadSelectedResults(format = 'txt') {
                if (this.selectedResults.size === 0) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø—É–±–ª–∏–∫–∞—Ü–∏—é –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–µ–∫–±–æ–∫—Å—ã —Ä—è–¥–æ–º —Å –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞.');
                    return;
                }
                
                const selectedResults = Array.from(this.selectedResults).map(index => this.results[index]);
                console.log(`–°–∫–∞—á–∏–≤–∞–Ω–∏–µ ${selectedResults.length} –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format.toUpperCase()}`);
                this.downloadResults(format, selectedResults);
            }

            showLoading() {
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                
                if (!resultsPanel || !resultsList) {
                    console.error('–≠–ª–µ–º–µ–Ω—Ç—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É');
                    return;
                }
                
                const resultsLimit = document.getElementById('resultsLimit')?.value || 50;
                
                resultsPanel.style.display = 'block';
                resultsPanel.classList.add('active');
                
                let loadingMessage = '–ü–æ–∏—Å–∫ –Ω–∞—É—á–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π...';
                const limit = parseInt(resultsLimit) || 50;
                
                if (limit >= 300) {
                    loadingMessage = `–ü–æ–∏—Å–∫ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π (–¥–æ ${limit})...<br><small style="color: #666;">–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥</small>`;
                } else if (limit >= 200) {
                    loadingMessage = `–ü–æ–∏—Å–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π (–¥–æ ${limit})...<br><small style="color: #666;">–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 15-30 —Å–µ–∫—É–Ω–¥</small>`;
                } else if (limit >= 100) {
                    loadingMessage = `–ü–æ–∏—Å–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π (–¥–æ ${limit})...<br><small style="color: #666;">–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 10-20 —Å–µ–∫—É–Ω–¥</small>`;
                } else {
                    loadingMessage = `–ü–æ–∏—Å–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π (–¥–æ ${limit})...`;
                }
                
                resultsList.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>${loadingMessage}</div>
                    </div>
                `;
            }

            showError(message) {
                console.error('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É:', message);
                
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                
                if (!resultsPanel || !resultsList) {
                    alert('–û—à–∏–±–∫–∞: ' + message);
                    console.error('–≠–ª–µ–º–µ–Ω—Ç—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –æ—à–∏–±–∫–∏');
                    return;
                }
                
                resultsPanel.style.display = 'block';
                resultsPanel.classList.add('active');
                
                resultsList.innerHTML = `
                    <div class="error">
                        <strong>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ</strong><br><br>
                        ${message.replace(/\n/g, '<br>')}
                        <div style="margin-top: 15px;">
                            <button class="search-btn" onclick="window.sciSearcher?.retrySearch()" style="margin-right: 10px;">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                            <button class="search-btn" onclick="window.sciSearcher?.tryAlternativeSearch()" style="background: #28a745; margin-right: 10px;">
                                üîç –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ (25 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
                            </button>
                            <button class="search-btn" onclick="window.sciSearcher?.searchWithoutYearFilters()" style="background: #6f42c1; margin-right: 10px;">
                                üìÖ –ü–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º
                            </button>
                            <button class="search-btn" onclick="window.sciSearcher?.runDiagnostics()" style="background: #17a2b8;">
                                üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
                            </button>
                        </div>
                    </div>
                `;
            }

            downloadResults(format = 'txt', selectedResults = null) {
                const resultsToDownload = selectedResults || this.results;
                
                if (resultsToDownload.length === 0) {
                    alert('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                    return;
                }

                let text, filename;
                
                switch(format) {
                    case 'apa':
                        text = this.formatResultsForAPA(resultsToDownload);
                        filename = `sci-search-results-apa-${new Date().toISOString().split('T')[0]}.txt`;
                        break;
                    case 'gost':
                        text = this.formatResultsForGOST(resultsToDownload);
                        filename = `sci-search-results-gost-${new Date().toISOString().split('T')[0]}.txt`;
                        break;
                    case 'bibtex':
                        text = this.formatResultsForBibTeX(resultsToDownload);
                        filename = `sci-search-results-bibtex-${new Date().toISOString().split('T')[0]}.bib`;
                        break;
                    default:
                        text = this.formatResultsForExport(resultsToDownload);
                        filename = `sci-search-results-${new Date().toISOString().split('T')[0]}.txt`;
                }

                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            copyResults() {
                if (this.results.length === 0) {
                    alert('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                    return;
                }

                const text = this.formatResultsForExport();
                navigator.clipboard.writeText(text).then(() => {
                    alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª.');
                });
            }

            formatResultsForExport(results = null) {
                const resultsToFormat = results || this.results;
                const keywords = document.getElementById('keywords').value;
                const startYear = document.getElementById('startYear').value;
                const endYear = document.getElementById('endYear').value;
                
                let text = `–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê –ù–ê–£–ß–ù–û–ô –õ–ò–¢–ï–†–ê–¢–£–†–´\n`;
                text += `–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: ${keywords}\n`;
                if (startYear || endYear) {
                    text += `–ü–µ—Ä–∏–æ–¥: ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\n`;
                }
                text += `–î–∞—Ç–∞ –ø–æ–∏—Å–∫–∞: ${new Date().toLocaleString('ru-RU')}\n`;
                text += `–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${resultsToFormat.length}\n\n`;
                text += `========================================\n\n`;

                resultsToFormat.forEach((work, index) => {
                    const title = work.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    
                    // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                    let authors = '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                    
                    if (work.authorships && work.authorships.length > 0) {
                        const authorNames = work.authorships
                            .map(authorship => authorship?.author?.display_name || 
                                               authorship?.author?.name ||
                                               authorship?.author?.title ||
                                               authorship?.display_name)
                            .filter(name => name && name.trim() !== '');
                        
                        if (authorNames.length > 0) {
                            authors = authorNames.join(', ');
                        }
                    } else if (work.authors && work.authors.length > 0) {
                        const authorNames = work.authors
                            .map(author => author?.display_name || author?.name || author?.title)
                            .filter(name => name && name.trim() !== '');
                        
                        if (authorNames.length > 0) {
                            authors = authorNames.join(', ');
                        }
                    } else if (work.author) {
                        authors = work.author.display_name || work.author.name || work.author.title || '–ê–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω';
                    }
                    
                    const journal = work.primary_location?.source?.display_name || '–ñ—É—Ä–Ω–∞–ª –Ω–µ —É–∫–∞–∑–∞–Ω';
                    const year = work.publication_year || '–ì–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω';
                    const doi = work.doi || work.id;

                    text += `${index + 1}. ${title}\n`;
                    text += `–ê–≤—Ç–æ—Ä—ã: ${authors}\n`;
                    text += `–ñ—É—Ä–Ω–∞–ª: ${journal}\n`;
                    text += `–ì–æ–¥: ${year}\n`;
                    text += `DOI: ${doi}\n\n`;
                });

                return text;
            }

            formatResultsForAPA(results = null) {
                const resultsToFormat = results || this.results;
                    const keywords = document.getElementById('keywords').value;
                    const startYear = document.getElementById('startYear').value;
                    const endYear = document.getElementById('endYear').value;
                
                let searchInfo = `Search keywords: ${keywords}\n`;
                    if (startYear || endYear) {
                        searchInfo += `Publication period: ${startYear || 'not specified'} - ${endYear || 'not specified'}\n`;
                }
                
                let text = `REFERENCES (APA FORMAT)\n`;
                text += searchInfo;
                text += `Search date: ${new Date().toLocaleString('en-US')}\n`;
                text += `Total results: ${resultsToFormat.length}\n\n`;

                resultsToFormat.forEach((work, index) => {
                    const title = work.title || 'Untitled';
                    const year = work.publication_year || work.year || 'n.d.';
                    const doi = work.doi || '';
                    const volume = work.biblio?.volume || work.volume || '';
                    const issue = work.biblio?.issue || work.issue || '';
                    // Format pages with range (first_page - last_page)
                    // OpenAlex API provides first_page and last_page in biblio object
                    // If both are available and different, show range (e.g., "215‚Äì220")
                    // If only first_page is available, show single page
                    // If no page info is available, pages remains empty
                    let pages = '';
                    const firstPage = work.biblio?.first_page || '';
                    const lastPage = work.biblio?.last_page || '';
                    if (firstPage && lastPage && firstPage !== lastPage) {
                        pages = `${firstPage}‚Äì${lastPage}`;
                    } else if (firstPage) {
                        pages = firstPage;
                    } else if (work.pages) {
                        pages = work.pages;
                    }

                    // Format authors in APA style with better null checks
                    let authorString = '';
                    const authors = work.authorships || [];
                    
                    if (authors.length === 0) {
                        // –ü–æ–ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∞–≤—Ç–æ—Ä–æ–≤
                        if (work.authors && work.authors.length > 0) {
                            const validAuthors = work.authors
                                .map(author => author?.display_name || author?.name || author?.title)
                                .filter(name => name && name.trim() !== '');
                            
                            if (validAuthors.length > 0) {
                                if (validAuthors.length === 1) {
                                    const name = validAuthors[0];
                                    const lastName = name.split(',')[0] || name.split(' ').pop();
                                    const firstName = name.split(',')[1]?.trim() || name.split(' ')[0];
                                    authorString = `${lastName}, ${firstName.charAt(0).toUpperCase()}.`;
                                } else if (validAuthors.length <= 7) {
                                    const formattedAuthors = validAuthors.map(name => {
                                        const lastName = name.split(',')[0] || name.split(' ').pop();
                                        const firstName = name.split(',')[1]?.trim() || name.split(' ')[0];
                                        return `${lastName}, ${firstName.charAt(0).toUpperCase()}.`;
                                    });
                                    authorString = formattedAuthors.join(', ');
                                } else {
                                    const firstAuthor = validAuthors[0];
                                    const lastName = firstAuthor.split(',')[0] || firstAuthor.split(' ').pop();
                                    const firstName = firstAuthor.split(',')[1]?.trim() || firstAuthor.split(' ')[0];
                                    authorString = `${lastName}, ${firstName.charAt(0).toUpperCase()}., et al.`;
                                }
                            } else {
                                authorString = 'Anonymous';
                            }
                        } else {
                            authorString = 'Anonymous';
                        }
                    } else {
                        const validAuthors = authors
                            .map(authorship => authorship?.author?.display_name || 
                                               authorship?.author?.name ||
                                               authorship?.author?.title ||
                                               authorship?.display_name)
                            .filter(name => name && name.trim() !== '');
                        
                        if (validAuthors.length === 0) {
                            authorString = 'Anonymous';
                        } else if (validAuthors.length === 1) {
                            const name = validAuthors[0];
                            const lastName = name.split(',')[0] || name.split(' ').pop();
                            const firstName = name.split(',')[1]?.trim() || name.split(' ')[0];
                            authorString = `${lastName}, ${firstName.charAt(0).toUpperCase()}.`;
                        } else if (validAuthors.length <= 7) {
                            const formattedAuthors = validAuthors.map(name => {
                                const lastName = name.split(',')[0] || name.split(' ').pop();
                                const firstName = name.split(',')[1]?.trim() || name.split(' ')[0];
                                return `${lastName}, ${firstName.charAt(0).toUpperCase()}.`;
                            });
                            authorString = formattedAuthors.join(', ');
                        } else {
                            const firstAuthor = validAuthors[0];
                            const lastName = firstAuthor.split(',')[0] || firstAuthor.split(' ').pop();
                            const firstName = firstAuthor.split(',')[1]?.trim() || firstAuthor.split(' ')[0];
                            authorString = `${lastName}, ${firstName.charAt(0).toUpperCase()}., et al.`;
                        }
                    }

                    // Format journal info
                    const journal = work.primary_location?.source?.display_name || 'Unknown Journal';
                    let journalInfo = journal;
                    if (volume) {
                        journalInfo += `, ${volume}`;
                        if (issue) {
                            journalInfo += `(${issue})`;
                        }
                        if (pages) {
                            journalInfo += `, ${pages}`;
                        } else {
                            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–º/–Ω–æ–º–µ—Ä, –Ω–æ –Ω–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü, –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ
                            journalInfo += `, [pages not specified]`;
                        }
                    }

                    // Construct APA reference
                    text += `${authorString} (${year}). ${title}. ${journalInfo}`;
                    if (doi) {
                        // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ https://doi.org/ –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –µ—Å—Ç—å
                        const cleanDoi = doi.startsWith('https://doi.org/') ? doi : `https://doi.org/${doi}`;
                        text += `. ${cleanDoi}`;
                    }
                    text += '.\n\n';
                });

                return text;
            }


            formatResultsForGOST(results = null) {
                const resultsToFormat = results || this.results;
                    const keywords = document.getElementById('keywords').value;
                    const startYear = document.getElementById('startYear').value;
                    const endYear = document.getElementById('endYear').value;
                
                let searchInfo = `–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ–∏—Å–∫–∞: ${keywords}\n`;
                    if (startYear || endYear) {
                        searchInfo += `–ü–µ—Ä–∏–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\n`;
                }
                
                let text = `–°–ü–ò–°–û–ö –õ–ò–¢–ï–†–ê–¢–£–†–´ (–ì–û–°–¢ 7.1-2003)\n`;
                text += searchInfo;
                text += `–î–∞—Ç–∞ –ø–æ–∏—Å–∫–∞: ${new Date().toLocaleString('ru-RU')}\n`;
                text += `–í—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${resultsToFormat.length}\n\n`;

                resultsToFormat.forEach((work, index) => {
                    const title = work.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    const year = work.publication_year || work.year || '–±.–≥.';
                    const doi = work.doi || '';
                    const volume = work.biblio?.volume || work.volume || '';
                    const issue = work.biblio?.issue || work.issue || '';
                    // Format pages with range (first_page - last_page)
                    // OpenAlex API provides first_page and last_page in biblio object
                    // If both are available and different, show range (e.g., "215‚Äì220")
                    // If only first_page is available, show single page
                    // If no page info is available, pages remains empty
                    let pages = '';
                    const firstPage = work.biblio?.first_page || '';
                    const lastPage = work.biblio?.last_page || '';
                    if (firstPage && lastPage && firstPage !== lastPage) {
                        pages = `${firstPage}‚Äì${lastPage}`;
                    } else if (firstPage) {
                        pages = firstPage;
                    } else if (work.pages) {
                        pages = work.pages;
                    }

                    // Format authors in GOST style with better null checks
                    let authorString = '';
                    const authors = work.authorships || [];
                    
                    if (authors.length === 0) {
                        authorString = '–ê–Ω–æ–Ω–∏–º';
                    } else {
                        const validAuthors = authors
                            .map(authorship => authorship?.author?.display_name)
                            .filter(name => name && name.trim() !== '');
                        
                        if (validAuthors.length === 0) {
                            authorString = '–ê–Ω–æ–Ω–∏–º';
                        } else if (validAuthors.length === 1) {
                            authorString = validAuthors[0];
                        } else if (validAuthors.length <= 3) {
                            authorString = validAuthors.join(', ');
                        } else {
                            authorString = `${validAuthors[0]} [–∏ –¥—Ä.]`;
                        }
                    }

                    // Format journal info
                    const journal = work.primary_location?.source?.display_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∂—É—Ä–Ω–∞–ª';
                    let journalInfo = journal;
                    if (volume) {
                        journalInfo += `. ‚Äì ${year}. ‚Äì –¢. ${volume}`;
                        if (issue) {
                            journalInfo += `, ‚Ññ ${issue}`;
                        }
                        if (pages) {
                            journalInfo += `. ‚Äì –°. ${pages}`;
                        } else {
                            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–º/–Ω–æ–º–µ—Ä, –Ω–æ –Ω–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü, –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ
                            journalInfo += `. ‚Äì [–°—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã]`;
                        }
                    } else {
                        journalInfo += `. ‚Äì ${year}`;
                    }

                    // Construct GOST reference
                    text += `${authorString} ${title} // ${journalInfo}`;
                    if (doi) {
                        // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ https://doi.org/ –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –µ—Å—Ç—å
                        const cleanDoi = doi.startsWith('https://doi.org/') ? doi : `https://doi.org/${doi}`;
                        text += `. ‚Äì DOI: ${cleanDoi}`;
                    }
                    text += '.\n\n';
                });

                return text;
            }

            formatResultsForBibTeX(results = null) {
                const resultsToFormat = results || this.results;
                
                let text = `% BibTeX entries generated by Sci-Searcher\n`;
                text += `% Generated on: ${new Date().toLocaleString('en-US')}\n`;
                text += `% Total entries: ${resultsToFormat.length}\n\n`;

                resultsToFormat.forEach((work, index) => {
                    const title = work.title || 'Untitled';
                    const year = work.publication_year || work.year || 'n.d.';
                    const doi = work.doi || '';
                    const volume = work.biblio?.volume || work.volume || '';
                    const issue = work.biblio?.issue || work.issue || '';
                    
                    // Format pages with range
                    let pages = '';
                    const firstPage = work.biblio?.first_page || '';
                    const lastPage = work.biblio?.last_page || '';
                    if (firstPage && lastPage && firstPage !== lastPage) {
                        pages = `${firstPage}--${lastPage}`;
                    } else if (firstPage) {
                        pages = firstPage;
                    } else if (work.pages) {
                        pages = work.pages;
                    }

                    // Format authors
                    let authorString = '';
                    const authors = work.authorships || [];
                    
                    if (authors.length === 0) {
                        authorString = 'Anonymous';
                    } else {
                        const validAuthors = authors
                            .map(authorship => authorship?.author?.display_name)
                            .filter(name => name && name.trim() !== '');
                        
                        if (validAuthors.length === 0) {
                            authorString = 'Anonymous';
                        } else {
                            authorString = validAuthors.join(' and ');
                        }
                    }

                    // Journal name
                    const journal = work.primary_location?.source?.display_name || 'Unknown Journal';
                    
                    // Generate BibTeX key
                    const bibtexKey = `work${index + 1}_${year}`;
                    
                    // Determine entry type
                    const sourceType = work.primary_location?.source?.type;
                    let entryType = 'article';
                    if (sourceType === 'book' || sourceType === 'monograph') {
                        entryType = 'book';
                    } else if (sourceType === 'proceedings') {
                        entryType = 'inproceedings';
                    }

                    text += `@${entryType}{${bibtexKey},\n`;
                    text += `  title = {${title}},\n`;
                    text += `  author = {${authorString}},\n`;
                    text += `  journal = {${journal}},\n`;
                    text += `  year = {${year}},\n`;
                    
                    if (volume) {
                        text += `  volume = {${volume}},\n`;
                    }
                    if (issue) {
                        text += `  number = {${issue}},\n`;
                    }
                    if (pages) {
                        text += `  pages = {${pages}},\n`;
                    }
                    if (doi) {
                        text += `  doi = {${doi}},\n`;
                    }
                    
                    text += `}\n\n`;
                });

                return text;
            }

            async checkApiStatus() {
                const statusElement = document.getElementById('apiStatus');
                
                // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏–º
                if (!statusElement) {
                    console.warn('–≠–ª–µ–º–µ–Ω—Ç apiStatus –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ API');
                    return;
                }
                
                try {
                    // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ OpenAlex API
                    const response = await fetch('https://api.openalex.org/works?search=test&per-page=1', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                        }
                    });
                    
                    if (response.ok) {
                        statusElement.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω ‚úÖ';
                        statusElement.style.color = '#28a745';
                    } else if (response.status === 403) {
                        statusElement.textContent = '–û–≥—Ä–∞–Ω–∏—á–µ–Ω ‚ö†Ô∏è';
                        statusElement.style.color = '#ffc107';
                    } else {
                        statusElement.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ ‚ö†Ô∏è';
                        statusElement.style.color = '#ffc107';
                    }
                } catch (error) {
                    if (error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                        statusElement.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ ‚ùå';
                        statusElement.style.color = '#dc3545';
                    } else {
                        statusElement.textContent = '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚ùå';
                        statusElement.style.color = '#dc3545';
                    }
                }
            }

            retrySearch() {
                // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–∏—Å–∫
                const form = document.getElementById('openalexForm');
                const event = new Event('submit');
                form.dispatchEvent(event);
            }

            async tryAlternativeSearch() {
                // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                const keywords = document.getElementById('keywords').value.trim();
                
                if (!keywords) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                    return;
                }

                this.showLoading();
                
                try {
                    // –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º –∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    const url = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=25&sort=publication_date:desc&data_version=2`;
                    
                    console.log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ URL:', url);
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —É—Å–ø–µ—à–µ–Ω:', data);
                        this.displayResults(data.results || []);
                } else {
                        throw new Error(`–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Ç–∞–∫–∂–µ –Ω–µ —É–¥–∞–ª—Å—è. –°—Ç–∞—Ç—É—Å: ${response.status}`);
                    }
                } catch (error) {
                    if (error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                        this.showError('–û—à–∏–±–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:\n\n' +
                            '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n' +
                            '‚Ä¢ –û—Ç–∫–ª—é—á–∏—Ç—å VPN –∏–ª–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å –≤—Ä–µ–º–µ–Ω–Ω–æ\n' +
                            '‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä\n' +
                            '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞\n' +
                            '‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É\n' +
                            '‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç—ã: pavel.alekseev.gasu@gmail.com');
                    } else {
                        this.showError('–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ–∏—Å–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:\n\n' +
                            '‚Ä¢ –ü–æ–¥–æ–∂–¥–∞—Ç—å 10-15 –º–∏–Ω—É—Ç –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É\n' +
                            '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n' +
                            '‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É\n' +
                            '‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN –¥–ª—è —Å–º–µ–Ω—ã IP-–∞–¥—Ä–µ—Å–∞');
                    }
                }
            }

            async searchWithoutYearFilters() {
                // –ü–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º
                const keywords = document.getElementById('keywords').value.trim();
                const resultsLimit = document.getElementById('resultsLimit').value;
                
                if (!keywords) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                    return;
                }

                this.showLoading();
                
                try {
                    // –ü–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º
                    const results = await this.searchOpenAlex(keywords, '', '', resultsLimit);
                    this.displayResults(results);
                } catch (error) {
                    this.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤: ' + error.message);
                }
            }

            async runDiagnostics() {
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                
                resultsList.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>–ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...</div>
                    </div>
                `;
                
                const diagnostics = [];
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ë–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
                try {
                    const testResponse = await fetch('https://httpbin.org/get', { method: 'GET' });
                    if (testResponse.ok) {
                        diagnostics.push('‚úÖ –ë–∞–∑–æ–≤–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç');
                    } else {
                        diagnostics.push('‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–≤—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º');
                    }
                } catch (error) {
                    diagnostics.push('‚ùå –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OpenAlex API (–ø–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
                try {
                    const openAlexResponse = await fetch('https://api.openalex.org/works?search=test&per-page=1&data_version=2', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                        }
                    });
                    
                    if (openAlexResponse.ok) {
                        const data = await openAlexResponse.json();
                        diagnostics.push(`‚úÖ OpenAlex API –¥–æ—Å—Ç—É–ø–µ–Ω (–ø–æ–ª—É—á–µ–Ω–æ ${data.results?.length || 0} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)`);
                    } else if (openAlexResponse.status === 403) {
                        diagnostics.push('‚ö†Ô∏è OpenAlex API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω (—Å—Ç–∞—Ç—É—Å: 403) - –≤–æ–∑–º–æ–∂–Ω–æ, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è');
                    } else if (openAlexResponse.status === 429) {
                        diagnostics.push('‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å—Ç–∞—Ç—É—Å: 429) - –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç');
                    } else {
                        diagnostics.push(`‚ùå OpenAlex API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Å—Ç–∞—Ç—É—Å: ${openAlexResponse.status})`);
                    }
                } catch (error) {
                    if (error.message.includes('Failed to fetch')) {
                        diagnostics.push('‚ùå –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ OpenAlex API (CORS –∏–ª–∏ —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)');
                    } else {
                        diagnostics.push(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ OpenAlex API: ${error.message}`);
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –∑–∞–ø—Ä–æ—Å –∫ OpenAlex API
                try {
                    const simpleResponse = await fetch('https://api.openalex.org/works?search=test&per-page=1');
                    
                    if (simpleResponse.ok) {
                        diagnostics.push('‚úÖ –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –∑–∞–ø—Ä–æ—Å –∫ OpenAlex API —Ä–∞–±–æ—Ç–∞–µ—Ç');
                    } else {
                        diagnostics.push(`‚ö†Ô∏è –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –∑–∞–ø—Ä–æ—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç–∞—Ç—É—Å: ${simpleResponse.status})`);
                    }
                } catch (error) {
                    diagnostics.push(`‚ùå –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –∑–∞–ø—Ä–æ—Å —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`);
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ
                const userAgent = navigator.userAgent;
                const isChrome = userAgent.includes('Chrome');
                const isFirefox = userAgent.includes('Firefox');
                const isSafari = userAgent.includes('Safari') && !userAgent.includes('Chrome');
                const isEdge = userAgent.includes('Edge');
                
                let browserInfo = '';
                if (isChrome) browserInfo = 'Chrome';
                else if (isFirefox) browserInfo = 'Firefox';
                else if (isSafari) browserInfo = 'Safari';
                else if (isEdge) browserInfo = 'Edge';
                else browserInfo = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä';
                
                diagnostics.push(`‚ÑπÔ∏è –ë—Ä–∞—É–∑–µ—Ä: ${browserInfo}`);
                diagnostics.push(`‚ÑπÔ∏è User Agent: ${userAgent.substring(0, 100)}...`);
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                resultsList.innerHTML = `
                    <div class="error">
                        <h3>üîß –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</h3>
                        <div style="text-align: left; margin: 20px 0;">
                            ${diagnostics.map(d => `<div style="margin: 10px 0;">${d}</div>`).join('')}
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="search-btn" onclick="window.sciSearcher.retrySearch()" style="margin-right: 10px;">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ —Å–Ω–æ–≤–∞
                            </button>
                            <button class="search-btn" onclick="window.sciSearcher.tryAlternativeSearch()" style="background: #28a745;">
                                üîç –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫
                            </button>
                        </div>
                    </div>
                `;
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —è–∑—ã–∫–æ–≤ –≤ —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
            analyzeLanguages() {
                if (!this.currentResults || this.currentResults.length === 0) {
                    console.log('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —è–∑—ã–∫–æ–≤');
                    return;
                }
                
                console.log('=== –ê–ù–ê–õ–ò–ó –Ø–ó–´–ö–û–í –í –¢–ï–ö–£–©–ò–• –†–ï–ó–£–õ–¨–¢–ê–¢–ê–• ===');
                
                const allLanguages = new Set();
                const languageStats = {};
                
                this.currentResults.forEach(work => {
                    const lang = work.language || '–Ω–µ —É–∫–∞–∑–∞–Ω';
                    allLanguages.add(lang);
                    languageStats[lang] = (languageStats[lang] || 0) + 1;
                });
                
                console.log('–í—Å–µ —è–∑—ã–∫–∏ –≤ —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö:', Array.from(allLanguages));
                console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —è–∑—ã–∫–æ–≤:', languageStats);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞
                Object.keys(languageStats).forEach(lang => {
                    const examples = this.currentResults.filter(work => (work.language || '–Ω–µ —É–∫–∞–∑–∞–Ω') === lang).slice(0, 3);
                    console.log(`–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —è–∑—ã–∫–∞ "${lang}":`, examples.map(w => w.title?.substring(0, 50) + '...'));
                });
                
                console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê ===');
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Ñ–∏–ª—å—Ç—Ä–æ–≤
            async testAllFilterCombinations() {
                const testKeywords = 'machine learning';
                const testCombinations = [
                    // –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
                    { startYear: 2020, endYear: 2023, language: 'en', openAccess: 'open', filterType: 'journals', sortOrder: 'newest' },
                    { startYear: 2020, endYear: 2023, language: 'ru', openAccess: 'all', filterType: 'all', sortOrder: 'relevance' },
                    { startYear: 2020, endYear: 2023, language: 'all', openAccess: 'closed', filterType: 'conferences', sortOrder: 'oldest' },
                    
                    // –¢–µ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –ø–æ –≥–æ–¥–∞–º
                    { startYear: 2020, endYear: 2023, language: 'all', openAccess: 'all', filterType: 'all', sortOrder: 'newest' },
                    { startYear: 2020, endYear: null, language: 'all', openAccess: 'all', filterType: 'all', sortOrder: 'newest' },
                    { startYear: null, endYear: 2023, language: 'all', openAccess: 'all', filterType: 'all', sortOrder: 'newest' },
                    
                    // –¢–µ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –ø–æ —è–∑—ã–∫—É
                    { startYear: null, endYear: null, language: 'en', openAccess: 'all', filterType: 'all', sortOrder: 'newest' },
                    { startYear: null, endYear: null, language: 'ru', openAccess: 'all', filterType: 'all', sortOrder: 'newest' },
                    { startYear: null, endYear: null, language: 'kk', openAccess: 'all', filterType: 'all', sortOrder: 'newest' },
                    
                    // –¢–µ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –ø–æ —Ç–∏–ø—É –ø—É–±–ª–∏–∫–∞—Ü–∏–π
                    { startYear: null, endYear: null, language: 'all', openAccess: 'all', filterType: 'journals', sortOrder: 'newest' },
                    { startYear: null, endYear: null, language: 'all', openAccess: 'all', filterType: 'conferences', sortOrder: 'newest' },
                    { startYear: null, endYear: null, language: 'all', openAccess: 'all', filterType: 'books', sortOrder: 'newest' },
                    
                    // –¢–µ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –ø–æ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –¥–æ—Å—Ç—É–ø—É
                    { startYear: null, endYear: null, language: 'all', openAccess: 'open', filterType: 'all', sortOrder: 'newest' },
                    { startYear: null, endYear: null, language: 'all', openAccess: 'closed', filterType: 'all', sortOrder: 'newest' },
                    
                    // –¢–µ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –ø–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ
                    { startYear: null, endYear: null, language: 'all', openAccess: 'all', filterType: 'all', sortOrder: 'newest' },
                    { startYear: null, endYear: null, language: 'all', openAccess: 'all', filterType: 'all', sortOrder: 'oldest' },
                    { startYear: null, endYear: null, language: 'all', openAccess: 'all', filterType: 'all', sortOrder: 'relevance' },
                ];
                
                console.log('üß™ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Ñ–∏–ª—å—Ç—Ä–æ–≤...');
                const results = [];
                
                for (let i = 0; i < testCombinations.length; i++) {
                    const combo = testCombinations[i];
                    console.log(`\n--- –¢–µ—Å—Ç ${i + 1}/${testCombinations.length} ---`);
                    console.log('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:', combo);
                    
                    try {
                        const startTime = Date.now();
                        const searchResults = await this.searchOpenAlex(
                            testKeywords, 
                            combo.startYear, 
                            combo.endYear, 
                            25, 
                            combo.sortOrder, 
                            combo.filterType, 
                            combo.language, 
                            combo.openAccess
                        );
                        const endTime = Date.now();
                        
                        const testResult = {
                            combination: combo,
                            success: true,
                            resultsCount: searchResults.length,
                            duration: endTime - startTime,
                            error: null
                        };
                        
                        results.push(testResult);
                        console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ: ${searchResults.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞ ${endTime - startTime}–º—Å`);
                        
                        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                    } catch (error) {
                        const testResult = {
                            combination: combo,
                            success: false,
                            resultsCount: 0,
                            duration: 0,
                            error: error.message
                        };
                        
                        results.push(testResult);
                        console.log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                    }
                }
                
                // –í—ã–≤–æ–¥–∏–º —Å–≤–æ–¥–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                console.log('\nüìä –°–í–û–î–ö–ê –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:');
                console.log(`–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${results.length}`);
                console.log(`–£—Å–ø–µ—à–Ω—ã—Ö: ${results.filter(r => r.success).length}`);
                console.log(`–ù–µ—É–¥–∞—á–Ω—ã—Ö: ${results.filter(r => !r.success).length}`);
                
                const successfulTests = results.filter(r => r.success);
                if (successfulTests.length > 0) {
                    const avgResults = successfulTests.reduce((sum, r) => sum + r.resultsCount, 0) / successfulTests.length;
                    const avgDuration = successfulTests.reduce((sum, r) => sum + r.duration, 0) / successfulTests.length;
                    console.log(`–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${avgResults.toFixed(1)}`);
                    console.log(`–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${avgDuration.toFixed(0)}–º—Å`);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
                const failedTests = results.filter(r => !r.success);
                if (failedTests.length > 0) {
                    console.log('\n‚ùå –ù–ï–£–î–ê–ß–ù–´–ï –¢–ï–°–¢–´:');
                    failedTests.forEach((test, index) => {
                        console.log(`${index + 1}. ${JSON.stringify(test.combination)} - ${test.error}`);
                    });
                }
                
                return results;
            }

            // –ú–µ—Ç–æ–¥—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
            getCacheKey(keywords, startYear, endYear, resultsLimit, sortOrder, filterType, language, openAccess) {
                return `${keywords}_${startYear}_${endYear}_${resultsLimit}_${sortOrder}_${filterType}_${language}_${openAccess}`;
            }

            getFromCache(key) {
                const cached = this.cache.get(key);
                if (cached && Date.now() - cached.timestamp < this.cacheExpiry) {
                    console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã');
                    return cached.data;
                }
                return null;
            }

            setCache(key, data) {
                this.cache.set(key, {
                    data: data,
                    timestamp: Date.now()
                });
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –∫—ç—à');
            }

        }

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        function loadSettings() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞
            const savedSettings = localStorage.getItem('searchSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    if (settings.sortOrder) document.getElementById('sortOrder').value = settings.sortOrder;
                    if (settings.filterType) document.getElementById('filterType').value = settings.filterType;
                    if (settings.language) document.getElementById('language').value = settings.language;
                    if (settings.openAccess) document.getElementById('openAccess').value = settings.openAccess;
                    if (settings.resultsLimit) document.getElementById('resultsLimit').value = settings.resultsLimit;
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', e);
                }
            }
        }

        function saveSettings() {
            const settings = {
                sortOrder: document.getElementById('sortOrder').value,
                filterType: document.getElementById('filterType').value,
                language: document.getElementById('language').value,
                openAccess: document.getElementById('openAccess').value,
                resultsLimit: document.getElementById('resultsLimit').value
            };
            localStorage.setItem('searchSettings', JSON.stringify(settings));
        }

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Enter - –ø–æ–∏—Å–∫
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                const searchBtn = document.getElementById('openalexSearchBtn');
                if (searchBtn) searchBtn.click();
            }
            
            // Escape - –æ—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            if (e.key === 'Escape') {
                const resultsPanel = document.getElementById('resultsPanel');
                if (resultsPanel && resultsPanel.style.display !== 'none') {
                    resultsPanel.style.display = 'none';
                }
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ FilterEngine
            if (typeof FilterEngine !== 'undefined') {
                console.log('‚úÖ FilterEngine –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω');
            } else {
                console.error('‚ùå FilterEngine –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω! –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞!');
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 6 –ª–µ—Ç
            const currentYear = new Date().getFullYear();
            const startYearDefault = currentYear - 5; // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 6 –ª–µ—Ç (–≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–∏–π)
            
            const startYearInput = document.getElementById('startYear');
            const endYearInput = document.getElementById('endYear');
            
            if (startYearInput) {
                startYearInput.placeholder = startYearDefault.toString();
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ
                if (!startYearInput.value) {
                    startYearInput.value = startYearDefault;
                }
                console.log('‚úÖ –ü–æ–ª–µ startYear –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
            } else {
                console.warn('‚ö†Ô∏è –ü–æ–ª–µ startYear –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            }
            
            if (endYearInput) {
                endYearInput.placeholder = currentYear.toString();
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ
                if (!endYearInput.value) {
                    endYearInput.value = currentYear;
                }
                console.log('‚úÖ –ü–æ–ª–µ endYear –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
            } else {
                console.warn('‚ö†Ô∏è –ü–æ–ª–µ endYear –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞ –≤ –ø–æ–¥—Å–∫–∞–∑–∫–µ
            const currentYearDisplay = document.getElementById('currentYearDisplay');
            if (currentYearDisplay) {
                currentYearDisplay.textContent = currentYear.toString();
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
            const form = document.getElementById('openalexForm');
            if (!form) {
                console.error('‚ùå –§–æ—Ä–º–∞ openalexForm –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM!');
            } else {
                console.log('‚úÖ –§–æ—Ä–º–∞ openalexForm –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM');
            }
            
            loadSettings();
            
            try {
            window.sciSearcher = new SciSearcher();
                console.log('‚úÖ –≠–∫–∑–µ–º–ø–ª—è—Ä SciSearcher —Å–æ–∑–¥–∞–Ω:', window.sciSearcher);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ SciSearcher:', error);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            ['sortOrder', 'filterType', 'language', 'openAccess', 'resultsLimit'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', saveSettings);
                } else {
                    console.warn(`‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                }
            });
            
            console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        });
    </script>
</body>
</html>
