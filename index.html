<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sci-Searcher | –ü–æ–∏—Å–∫–æ–≤–∏–∫ –Ω–∞—É—á–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            /* Light theme colors */
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --accent-primary: #3498db;
            --accent-secondary: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --border-color: #e1e5e9;
            --shadow: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-hover: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        [data-theme="dark"] {
            /* Dark theme colors */
            --bg-primary: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --bg-secondary: #2c3e50;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --accent-primary: #3498db;
            --accent-secondary: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --border-color: #34495e;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
            --shadow-hover: 0 8px 25px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
            padding: 20px;
            position: relative;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
            margin: 0;
            font-weight: 400;
        }

        .version-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 4px 8px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
            z-index: 1000;
        }

        [data-theme="dark"] .version-info {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .developer-info {
            margin: 20px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .developer-info p {
            margin: 6px 0;
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .developer-info a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .developer-info a:hover {
            color: #f0f0f0;
            text-decoration: underline;
        }

        .app-description {
            margin: 20px 0;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .app-description p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.5;
            font-weight: 400;
        }

        .search-panel {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 20px;
        }

        .main-search-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 20px;
        }

        .search-input-group {
            display: flex;
            gap: 12px;
            align-items: end;
        }

        .search-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            transform: translateY(-1px);
        }

        .search-btn-main {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Inter', sans-serif;
            min-width: 160px;
        }

        .search-btn-main:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .quick-filters {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .quick-filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .quick-filter-group label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .quick-filter-group select {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            min-width: 120px;
        }

        .advanced-search-toggle {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .advanced-search-toggle:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .advanced-search-panel {
            display: none;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }

        .advanced-search-panel.active {
            display: block;
        }

        .advanced-filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .search-panel:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .search-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            align-items: start;
            max-width: 100%;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            align-items: stretch;
            max-width: 100%;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            height: 72px;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-primary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            height: 24px;
            display: flex;
            align-items: center;
            line-height: 1.2;
            flex-shrink: 0;
        }

        .form-group input, .form-group select {
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            height: 42px;
            box-sizing: border-box;
            flex-shrink: 0;
            margin-top: auto;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
            transform: translateY(-1px);
        }

        .form-group small {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-top: 3px;
            line-height: 1.3;
        }

        .search-btn {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Inter', sans-serif;
            position: relative;
            overflow: hidden;
            width: 100%;
            margin-top: 8px;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .search-btn:hover::before {
            left: 100%;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-panel {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            height: fit-content;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .results-count {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .export-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .export-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .copy-btn {
            background: #17a2b8;
        }

        .copy-btn:hover {
            background: #138496;
        }

        .results-list {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .result-item {
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            background: #fafbfc;
        }

        .result-item:hover {
            border-color: #667eea;
            box-shadow: 0 3px 8px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .result-title {
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 6px;
            line-height: 1.3;
        }

        .result-authors {
            color: #666;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .result-journal {
            color: #8e44ad;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 0.8rem;
        }

        .result-year {
            color: #e74c3c;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 0.8rem;
        }

        .result-abstract {
            color: #555;
            line-height: 1.4;
            font-size: 0.8rem;
            margin-bottom: 6px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è HTML-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö */
        .result-abstract p {
            margin: 0 0 8px 0;
        }

        .result-abstract p:last-child {
            margin-bottom: 0;
        }

        .result-abstract em,
        .result-abstract i {
            font-style: italic;
        }

        .result-abstract strong,
        .result-abstract b {
            font-weight: bold;
        }

        .result-abstract span {
            display: inline;
        }

        .result-abstract div {
            display: block;
        }

        .result-abstract br {
            line-height: 1.2;
        }

        .abstract-preview {
            max-height: 60px;
            overflow: hidden;
            position: relative;
        }

        .abstract-preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(transparent, #fafbfc);
        }

        .abstract-full {
            max-height: none;
        }

        .toggle-abstract {
            background: none;
            border: none;
            color: #667eea;
            font-size: 0.75rem;
            cursor: pointer;
            padding: 2px 0;
            margin-top: 4px;
            text-decoration: underline;
        }

        .toggle-abstract:hover {
            color: #5a6fd8;
        }

        .result-checkbox {
            margin-right: 8px;
            transform: scale(0.9);
        }

        .result-item.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .selection-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            align-items: center;
            flex-wrap: wrap;
        }

        .select-all-btn, .clear-selection-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .select-all-btn:hover, .clear-selection-btn:hover {
            background: #5a6268;
        }

        .selected-count {
            font-size: 0.8rem;
            color: #666;
            font-weight: 500;
        }

        .selection-controls .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .selection-controls .export-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .result-doi {
            color: #3498db;
            font-size: 0.75rem;
            text-decoration: none;
        }

        .result-doi:hover {
            text-decoration: underline;
        }

        .result-link {
            color: #3498db;
            font-size: 0.85rem;
            text-decoration: none;
            display: inline-block;
            margin-top: 8px;
            padding: 5px 10px;
            background: #e3f2fd;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .result-link:hover {
            background: #bbdefb;
            text-decoration: none;
            transform: translateY(-1px);
        }

        .footer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 15px 20px;
            margin-top: 20px;
            border-radius: 8px 8px 0 0;
        }

        .footer-content p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
        }

        @media (max-width: 1200px) {
            .container {
                padding: 15px;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .search-input-group {
                flex-direction: column;
                gap: 12px;
            }
            
            .search-input {
                font-size: 1rem;
                padding: 14px 16px;
            }
            
            .search-btn-main {
                width: 100%;
                padding: 14px 20px;
                font-size: 1rem;
            }
            
            .quick-filters {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            .quick-filter-group select {
                width: 100%;
            }
            
            .advanced-filters-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .results-panel {
                padding: 15px;
            }
            
            .result-item {
                padding: 12px;
            }
            
            .result-title {
                font-size: 1rem;
            }
            
            .result-authors {
                font-size: 0.8rem;
            }
            
            .result-journal {
                font-size: 0.8rem;
            }
            
            .export-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .export-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .selection-controls {
                flex-direction: column;
                gap: 8px;
            }
            
            .select-all-btn, .clear-selection-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .footer {
                padding: 10px 15px;
                margin-top: 15px;
            }
            
            .footer-content p {
                font-size: 0.8rem;
            }
        }

        .hidden {
            display: none;
        }

        .analytics-panel {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .analytics-panel h3 {
            color: var(--text-primary);
            margin-bottom: 16px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .analytics-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .analytics-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .analytics-content {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .analytics-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .analytics-item:last-child {
            border-bottom: none;
        }

        .analytics-bar {
            width: 100%;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 4px;
        }

        .analytics-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--success));
            transition: width 0.3s ease;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
            backdrop-filter: blur(10px);
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .search-type {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-type label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .search-type input[type="radio"] {
            margin: 0;
        }

        .button-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .current-year-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .current-year-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .current-year-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .quick-periods {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .period-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .period-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .period-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .period-btn.active {
            background: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }




        .results-panel {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            display: none;
            margin-top: 20px;
        }

        .results-panel.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .export-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .export-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .copy-btn {
            background: #17a2b8;
        }

        .copy-btn:hover {
            background: #138496;
        }

        .results-list {
            max-height: 70vh;
            overflow-y: auto;
        }

        .result-item {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .result-item:hover {
            border-color: #667eea;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .result-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .result-authors {
            color: #666;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        .result-journal {
            color: #8e44ad;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .result-year {
            color: #e74c3c;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .result-abstract {
            color: #555;
            line-height: 1.5;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .result-doi {
            color: #3498db;
            font-size: 0.8rem;
            text-decoration: none;
        }

        .result-doi:hover {
            text-decoration: underline;
        }

        .result-link {
            color: #3498db;
            font-size: 0.8rem;
            text-decoration: none;
            display: inline-block;
            margin-top: 6px;
            padding: 4px 8px;
            background: #e3f2fd;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .result-link:hover {
            background: #bbdefb;
            text-decoration: none;
            transform: translateY(-1px);
        }


    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="version-info" id="versionInfo">v1.0.0</div>
            <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                <svg viewBox="0 0 24 24">
                    <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
                </svg>
            </button>
            <h1>Sci-Searcher</h1>
            <p>–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤–∏–∫ –Ω–∞—É—á–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã</p>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–æ–∏—Å–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="search-panel">
            <form class="search-form" id="openalexForm">
                <div class="main-search-section">
                    <div class="search-input-group">
                        <input type="text" id="keywords" class="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞..." required>
                        <button type="submit" class="search-btn-main" id="openalexSearchBtn">
                            üîç –ü–æ–∏—Å–∫
                        </button>
                    </div>
                    
                    <div class="quick-filters">
                        <div class="quick-filter-group">
                            <label for="searchMode">–†–µ–∂–∏–º</label>
                            <select id="searchMode">
                                <option value="simple">–ü—Ä–æ—Å—Ç–æ–π</option>
                                <option value="advanced">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π</option>
                                <option value="exact">–¢–æ—á–Ω–∞—è —Ñ—Ä–∞–∑–∞</option>
                            </select>
                        </div>
                        
                        <div class="quick-filter-group">
                            <label for="resultsLimit">–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</label>
                            <select id="resultsLimit">
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="200">200</option>
                                <option value="300">300</option>
                                <option value="500">500</option>
                            </select>
                        </div>
                        
                        <div class="quick-filter-group">
                            <label for="startYear">–ì–æ–¥ –æ—Ç</label>
                            <input type="number" id="startYear" min="1700" placeholder="2019" style="padding: 8px 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 0.9rem; background: var(--bg-secondary); color: var(--text-primary); font-family: 'Inter', sans-serif; min-width: 120px;">
                        </div>
                        
                        <div class="quick-filter-group">
                            <label for="endYear">–ì–æ–¥ –¥–æ</label>
                            <input type="number" id="endYear" min="1700" placeholder="2025" style="padding: 8px 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 0.9rem; background: var(--bg-secondary); color: var(--text-primary); font-family: 'Inter', sans-serif; min-width: 120px;">
                        </div>
                        
                        <div class="year-range-info" style="font-size: 0.8rem; color: #666; margin-top: 5px; text-align: center;">
                            üìÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –ª–µ—Ç | –î–∏–∞–ø–∞–∑–æ–Ω: –æ—Ç 1700 –≥–æ–¥–∞ –¥–æ <span id="currentYearDisplay">2025</span> –≥–æ–¥–∞ –∏ –¥–∞–ª–µ–µ
                        </div>
                        
                        <button type="button" class="advanced-search-toggle" id="advancedToggle">
                            ‚öôÔ∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                    </div>
                </div>
                
                <div class="advanced-search-panel" id="advancedPanel">
                    <div class="advanced-filters-grid">
                        <div class="form-group">
                            <label for="filterType">–¢–∏–ø –ø—É–±–ª–∏–∫–∞—Ü–∏–π</label>
                            <select id="filterType">
                                <option value="all">–í—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</option>
                                <option value="journals">–¢–æ–ª—å–∫–æ –∂—É—Ä–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</option>
                                <option value="conferences">–ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏</option>
                                <option value="books">–ö–Ω–∏–≥–∏ –∏ –≥–ª–∞–≤—ã</option>
                                <option value="no_repositories">–ò—Å–∫–ª—é—á–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="language">–Ø–∑—ã–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                            <select id="language">
                                <option value="all">–í—Å–µ —è–∑—ã–∫–∏</option>
                                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                                <option value="kk">–ö–∞–∑–∞—Ö—Å–∫–∏–π</option>
                                <option value="en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                                <option value="de">–ù–µ–º–µ—Ü–∫–∏–π</option>
                                <option value="fr">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
                                <option value="es">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
                                <option value="zh-cn">–ö–∏—Ç–∞–π—Å–∫–∏–π (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)</option>
                                <option value="zh-tw">–ö–∏—Ç–∞–π—Å–∫–∏–π (—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π)</option>
                                <option value="ja">–Ø–ø–æ–Ω—Å–∫–∏–π</option>
                                <option value="ko">–ö–æ—Ä–µ–π—Å–∫–∏–π</option>
                                <option value="ar">–ê—Ä–∞–±—Å–∫–∏–π</option>
                                <option value="pt">–ü–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π</option>
                                <option value="it">–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="openAccess">–û—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø</label>
                            <select id="openAccess">
                                <option value="all">–í—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</option>
                                <option value="open">–¢–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø</option>
                                <option value="closed">–¢–æ–ª—å–∫–æ –ø–ª–∞—Ç–Ω—ã–µ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="sortOrder">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                            <select id="sortOrder">
                                <option value="newest">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                                <option value="oldest">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                                <option value="relevance">–ü–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏</option>
                            </select>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="results-panel" id="resultsPanel">
            <div class="results-header">
                <div class="results-count" id="resultsCount"></div>
                <div class="export-buttons">
                    <button class="export-btn" id="downloadApaBtn">
                        üìÑ APA
                    </button>
                    <button class="export-btn" id="downloadGostBtn">
                        üìã –ì–û–°–¢
                    </button>
                    <button class="export-btn" id="downloadBibtexBtn">
                        üìö BibTeX
                    </button>
                    <button class="export-btn copy-btn" id="copyBtn">
                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </div>
            
            <div class="analytics-panel" id="analyticsPanel" style="display: none;">
                <h3>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-title">–¢–æ–ø –∞–≤—Ç–æ—Ä—ã</div>
                        <div class="analytics-content" id="topAuthors"></div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-title">–¢–æ–ø –∂—É—Ä–Ω–∞–ª—ã</div>
                        <div class="analytics-content" id="topJournals"></div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–æ–¥–∞–º</div>
                        <div class="analytics-content" id="yearDistribution"></div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-title">–û—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø</div>
                        <div class="analytics-content" id="openAccessStats"></div>
                    </div>
                </div>
            </div>
            <div class="selection-controls" id="selectionControls" style="display: none;">
                <input type="checkbox" id="selectAllCheckbox">
                <label for="selectAllCheckbox">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</label>
                <button class="select-all-btn" id="selectAllBtn">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
                <button class="clear-selection-btn" id="clearSelectionBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
                <span class="selected-count" id="selectedCount">–í—ã–±—Ä–∞–Ω–æ: 0</span>
                <button class="export-btn" id="downloadSelectedApaBtn" style="display: none;">üìÑ APA</button>
                <button class="export-btn" id="downloadSelectedGostBtn" style="display: none;">üìã –ì–û–°–¢</button>
                <button class="export-btn" id="downloadSelectedTxtBtn" style="display: none;">üì• TXT</button>
            </div>
            <div class="results-list" id="resultsList"></div>
        </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü.–í. –ê–ª–µ–∫—Å–µ–µ–≤, –ì–æ—Ä–Ω–æ-–ê–ª—Ç–∞–π—Å–∫–∏–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</p>
        </div>
    </footer>

    <script>
        class SciSearcher {
        constructor() {
            this.results = [];
            this.currentSource = 'openalex';
            this.selectedResults = new Set();
            this.cache = new Map(); // –ö—ç—à –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
            this.cacheExpiry = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
            this.version = '1.0.0'; // –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è
            this.updateVersionDisplay();
            this.init();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏
        updateVersionDisplay() {
            const versionElement = document.getElementById('versionInfo');
            if (versionElement) {
                versionElement.textContent = `v${this.version}`;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏)
        updateVersion() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
            const now = new Date();
            const timestamp = now.getTime();
            const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '');
            const timeStr = now.toTimeString().slice(0, 8).replace(/:/g, '');
            
            // –§–æ—Ä–º–∞—Ç: v1.0.YYYYMMDD.HHMMSS
            this.version = `1.0.${dateStr}.${timeStr}`;
            this.updateVersionDisplay();
            
            console.log(`Sci-Searcher –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ –≤–µ—Ä—Å–∏–∏ ${this.version}`);
        }

            init() {
                this.updateVersion(); // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Ä—Å–∏—é –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
                this.initTheme();
                this.initForms();
                this.initExportButtons();
                this.initSelectionControls();
                this.checkApiStatus();
            }

            initTheme() {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
                const themeToggle = document.getElementById('themeToggle');
                if (themeToggle) {
                    themeToggle.addEventListener('click', () => {
                        const currentTheme = document.documentElement.getAttribute('data-theme');
                        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                        document.documentElement.setAttribute('data-theme', newTheme);
                        localStorage.setItem('theme', newTheme);
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
                        themeToggle.style.transform = 'rotate(180deg)';
                        setTimeout(() => {
                            themeToggle.style.transform = 'rotate(0deg)';
                        }, 300);
                    });
                }
            }

            initForms() {
                const openalexForm = document.getElementById('openalexForm');
                openalexForm.addEventListener('submit', (e) => this.handleOpenAlexSearch(e));
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
                const advancedToggle = document.getElementById('advancedToggle');
                const advancedPanel = document.getElementById('advancedPanel');
                
                if (advancedToggle && advancedPanel) {
                    advancedToggle.addEventListener('click', () => {
                        const isActive = advancedPanel.classList.contains('active');
                        if (isActive) {
                            advancedPanel.classList.remove('active');
                            advancedToggle.textContent = '‚öôÔ∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã';
                        } else {
                            advancedPanel.classList.add('active');
                            advancedToggle.textContent = '‚öôÔ∏è –°–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã';
                        }
                    });
                }
            }

            initExportButtons() {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö –∫–Ω–æ–ø–æ–∫
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'downloadApaBtn') {
                        e.preventDefault();
                        this.downloadResults('apa');
                    } else if (e.target.id === 'downloadGostBtn') {
                        e.preventDefault();
                        this.downloadResults('gost');
                    } else if (e.target.id === 'downloadBibtexBtn') {
                        e.preventDefault();
                        this.downloadResults('bibtex');
                    } else if (e.target.id === 'copyBtn') {
                        e.preventDefault();
                        this.copyResults();
                    } else if (e.target.id === 'downloadSelectedApaBtn') {
                        e.preventDefault();
                        this.downloadSelectedResults('apa');
                    } else if (e.target.id === 'downloadSelectedGostBtn') {
                        e.preventDefault();
                        this.downloadSelectedResults('gost');
                    } else if (e.target.id === 'downloadSelectedTxtBtn') {
                        e.preventDefault();
                        this.downloadSelectedResults('txt');
                    }
                });
            }

            initSelectionControls() {
                const selectAllBtn = document.getElementById('selectAllBtn');
                const clearSelectionBtn = document.getElementById('clearSelectionBtn');
                const selectAllCheckbox = document.getElementById('selectAllCheckbox');

                if (selectAllBtn) selectAllBtn.addEventListener('click', () => this.selectAllResults());
                if (clearSelectionBtn) clearSelectionBtn.addEventListener('click', () => this.clearSelection());
                if (selectAllCheckbox) selectAllCheckbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        this.selectAllResults();
                    } else {
                        this.clearSelection();
                    }
                });
            }

            async handleOpenAlexSearch(e) {
                e.preventDefault();
                
                const keywords = document.getElementById('keywords').value.trim();
                const startYear = document.getElementById('startYear').value;
                const endYear = document.getElementById('endYear').value;
                const resultsLimit = document.getElementById('resultsLimit').value;
                const sortOrder = document.getElementById('sortOrder').value;
                const filterType = document.getElementById('filterType').value;
                const language = document.getElementById('language').value;
                const openAccess = document.getElementById('openAccess').value;

                if (!keywords) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                    return;
                }

                this.showLoading();
                
                try {
                    const results = await this.searchOpenAlex(keywords, startYear, endYear, resultsLimit, sortOrder, filterType, language, openAccess);
                    this.displayResults(results);
                } catch (error) {
                    this.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ: ' + error.message);
                }
            }




            async searchOpenAlex(keywords, startYear, endYear, resultsLimit, sortOrder = 'newest', filterType = 'all', language = 'all', openAccess = 'all') {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
                const cacheKey = this.getCacheKey(keywords, startYear, endYear, resultsLimit, sortOrder, filterType, language, openAccess);
                const cachedResults = this.getFromCache(cacheKey);
                if (cachedResults) {
                    return cachedResults;
                }

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å —É—á–µ—Ç–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π API
                const perPage = 50; // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º 50 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
                const targetResults = parseInt(resultsLimit);
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–æ–¥–æ–≤
                const currentYear = new Date().getFullYear();
                const minYear = 1700; // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≥–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞
                if (startYear && startYear < minYear) {
                    throw new Error(`–ì–æ–¥ –Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ —Ä–∞–Ω–µ–µ ${minYear}`);
                }
                if (endYear && endYear < minYear) {
                    throw new Error(`–ì–æ–¥ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ —Ä–∞–Ω–µ–µ ${minYear}`);
                }
                if (startYear && endYear && startYear > endYear) {
                    throw new Error('–ì–æ–¥ –Ω–∞—á–∞–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –≥–æ–¥–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è');
                }
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è OpenAlex API —Å –∑–∞–ø—Ä–æ—Å–æ–º –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –¥–∞–Ω–Ω—ã—Ö (data_version=2) –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
                // –î–æ–±–∞–≤–ª—è–µ–º select –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–≤—Ç–æ—Ä–∞—Ö
                let url = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=${perPage}&data_version=2&select=id,title,authorships.author.display_name,authorships.author.id,publication_year,primary_location.source.display_name,doi,abstract_inverted_index,abstract,description,summary,biblio.first_page,biblio.last_page,landing_page_url`;
                
                // –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –≥–æ–¥–∞–º –¥–ª—è OpenAlex API
                if (startYear && endYear) {
                    // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –æ–±–∞ –≥–æ–¥–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å OpenAlex
                    url += `&filter=publication_year:${startYear}-${endYear}`;
                } else if (startYear) {
                    // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª—å–Ω—ã–π –≥–æ–¥
                    url += `&filter=publication_year:>=${startYear}`;
                } else if (endYear) {
                    // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—á–Ω—ã–π –≥–æ–¥
                    url += `&filter=publication_year:<=${endYear}`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø—É –ø—É–±–ª–∏–∫–∞—Ü–∏–π
                if (filterType === 'journals') {
                    url += `&filter=type:journal-article`;
                } else if (filterType === 'conferences') {
                    url += `&filter=type:proceedings-article`;
                } else if (filterType === 'books') {
                    url += `&filter=type:book,monograph`;
                } else if (filterType === 'no_repositories') {
                    url += `&filter=type:journal-article,proceedings-article,book,monograph`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ —è–∑—ã–∫—É
                if (language !== 'all') {
                    url += `&filter=language:${language}`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –¥–æ—Å—Ç—É–ø—É
                if (openAccess === 'open') {
                    url += `&filter=is_oa:true`;
                } else if (openAccess === 'closed') {
                    url += `&filter=is_oa:false`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å —É—á–µ—Ç–æ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                switch(sortOrder) {
                    case 'oldest':
                        url += '&sort=publication_date:asc';
                        break;
                    case 'relevance':
                        url += '&sort=relevance_score:desc';
                        break;
                    case 'newest':
                    default:
                        url += '&sort=publication_date:desc';
                        break;
                }

                console.log('OpenAlex API URL:', url);
                console.log('Search parameters:', { keywords, startYear, endYear, resultsLimit });
                console.log('Year filters applied:', { startYear, endYear, hasFilters: !!(startYear || endYear) });
                console.log('Using OpenAlex data_version=2 (improved metadata quality)');

                try {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                        }
                    });
                    
                    if (!response.ok) {
                        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –≥–æ–¥–∞–º –∏–ª–∏ —è–∑—ã–∫—É –∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –ø—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –±–µ–∑ –Ω–∏—Ö
                        if ((response.status === 403 || response.status === 400) && (startYear || endYear || language !== 'all')) {
                            console.log(`–û—à–∏–±–∫–∞ ${response.status} —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –ø—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤...`);
                            
                            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤
                            let sortParam = 'publication_date:desc';
                            switch(sortOrder) {
                                case 'oldest':
                                    sortParam = 'publication_date:asc';
                                    break;
                                case 'relevance':
                                    sortParam = 'relevance_score:desc';
                                    break;
                            }
                            
                            // –°–æ–∑–¥–∞–µ–º URL –±–µ–∑ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
                            let fallbackUrl = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=${perPage}&sort=${sortParam}&data_version=2&select=id,title,authorships.author.display_name,authorships.author.id,publication_year,primary_location.source.display_name,doi,abstract_inverted_index,abstract,description,summary,biblio.first_page,biblio.last_page,landing_page_url`;
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
                            if (filterType === 'journals') {
                                fallbackUrl += `&filter=type:journal-article`;
                            } else if (filterType === 'conferences') {
                                fallbackUrl += `&filter=type:proceedings-article`;
                            } else if (filterType === 'books') {
                                fallbackUrl += `&filter=type:book,monograph`;
                            } else if (filterType === 'no_repositories') {
                                fallbackUrl += `&filter=type:journal-article,proceedings-article,book,monograph`;
                            }
                            
                            // –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ —è–∑—ã–∫—É –≤ fallback, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏
                            
                            if (openAccess === 'open') {
                                fallbackUrl += `&filter=is_oa:true`;
                            } else if (openAccess === 'closed') {
                                fallbackUrl += `&filter=is_oa:false`;
                            }
                            
                            const fallbackResponse = await fetch(fallbackUrl, {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json',
                                    'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                                }
                            });
                            
                            if (fallbackResponse.ok) {
                                const fallbackData = await fallbackResponse.json();
                                let results = fallbackData.results || [];
                                
                                // –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —è–∑—ã–∫—É –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞, –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ —è–∑—ã–∫—É –±—ã–ª –∑–∞–ø—Ä–æ—à–µ–Ω
                                if (language !== 'all') {
                                    const originalCount = results.length;
                                    
                                    // –õ–æ–≥–∏—Ä—É–µ–º —è–∑—ã–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
                                    console.log(`–ò—Å—Ö–æ–¥–Ω—ã–µ —è–∑—ã–∫–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ ${language}:`);
                                    results.slice(0, 10).forEach((work, index) => {
                                        console.log(`  ${index + 1}. ${work.title?.substring(0, 50)}... - —è–∑—ã–∫: ${work.language || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);
                                    });
                                    
                                    results = results.filter(work => {
                                        const workLanguage = work.language;
                                        if (!workLanguage) return true; // –ï—Å–ª–∏ —è–∑—ã–∫ –Ω–µ —É–∫–∞–∑–∞–Ω, –≤–∫–ª—é—á–∞–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                        return workLanguage === language;
                                    });
                                    
                                    console.log(`–ü–æ—Å–ª–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —è–∑—ã–∫—É ${language}: ${results.length} –∏–∑ ${originalCount} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                                    
                                    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ã–ª–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã
                                    if (results.length > 0 && originalCount > results.length) {
                                        results[0]._warning = `‚ö†Ô∏è –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —è–∑—ã–∫—É "${language}" –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–∫–∞–∑–∞–Ω—ã ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.`;
                                    }
                                }
                                
                                // –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –≥–æ–¥–∞–º –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
                                if (startYear || endYear) {
                                    const originalCount = results.length;
                                    results = results.filter(work => {
                                        const year = work.publication_year;
                                        if (!year) return true; // –ï—Å–ª–∏ –≥–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω, –≤–∫–ª—é—á–∞–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                        
                                        if (startYear && endYear) {
                                            return year >= parseInt(startYear) && year <= parseInt(endYear);
                                        } else if (startYear) {
                                            return year >= parseInt(startYear);
                                        } else if (endYear) {
                                            return year <= parseInt(endYear);
                                        }
                                        return true;
                                    });
                                    
                                    console.log(`–ü–æ—Å–ª–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –≥–æ–¥–∞–º: ${results.length} –∏–∑ ${originalCount} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                                    
                                    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ã–ª–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã
                                    if (results.length > 0 && originalCount > results.length) {
                                        results[0]._warning = `‚ö†Ô∏è –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥–æ–¥–∞–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–∫–∞–∑–∞–Ω—ã ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –≥–æ–¥–∞–º ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}.`;
                                    }
                                }
                                
                                return results;
                            } else {
                                throw new Error('–î–æ—Å—Ç—É–ø –∫ OpenAlex API –≤—Ä–µ–º–µ–Ω–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n\n' +
                                    '‚Ä¢ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –≤–∞—à–µ–≥–æ IP-–∞–¥—Ä–µ—Å–∞\n' +
                                    '‚Ä¢ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API\n' +
                                    '‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é\n\n' +
                                    '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n' +
                                    '‚Ä¢ –ü–æ–¥–æ–∂–¥–∞—Ç—å 5-10 –º–∏–Ω—É—Ç –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å\n' +
                                    '‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN –∏–ª–∏ –¥—Ä—É–≥–æ–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç\n' +
                                    '‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É: pavel.alekseev.gasu@gmail.com');
                            }
                        } else if (response.status === 429) {
                            throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenAlex API. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å.');
                        } else if (response.status === 400) {
                            // –û—à–∏–±–∫–∞ 400 –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º
                            throw new Error('–û—à–∏–±–∫–∞ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø–æ–∏—Å–∫–∞. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n\n' +
                                '‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞\n' +
                                '‚Ä¢ –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤–∞—Ö\n' +
                                '‚Ä¢ –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã\n\n' +
                                '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n' +
                                '‚Ä¢ –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å\n' +
                                '‚Ä¢ –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã\n' +
                                '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
                        } else {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                    }
                
                const data = await response.json();
                    console.log('OpenAlex API response:', data);
                    console.log('Total results found:', data.meta?.count || 0);
                    
                    // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —è–∑—ã–∫–∞—Ö –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
                    if (data.results && data.results.length > 0) {
                        console.log('=== –ê–ù–ê–õ–ò–ó –Ø–ó–´–ö–û–í –í OPENALEX API ===');
                        
                        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —è–∑—ã–∫–∏
                        const allLanguages = new Set();
                        const languageStats = {};
                        
                        data.results.forEach(work => {
                            const lang = work.language || '–Ω–µ —É–∫–∞–∑–∞–Ω';
                            allLanguages.add(lang);
                            languageStats[lang] = (languageStats[lang] || 0) + 1;
                        });
                        
                        console.log('–í—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –≤ API:', Array.from(allLanguages));
                        console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —è–∑—ã–∫–æ–≤:', languageStats);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–≤—ã—Ö 10 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
                        console.log('–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —è–∑—ã–∫–∞—Ö:');
                        data.results.slice(0, 10).forEach((work, index) => {
                            console.log(`${index + 1}. "${work.title?.substring(0, 50)}..." - —è–∑—ã–∫: "${work.language}"`);
                        });
                        
                        console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –Ø–ó–´–ö–û–í ===');
                    }
                    
                    let results = data.results || [];
                    
                    // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
                    if (startYear || endYear) {
                        console.log(`Searching with year filters: ${startYear || 'none'} to ${endYear || 'none'}`);
                        console.log(`Results with filters: ${results.length}`);
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
                        if (results.length > 0) {
                            results[0]._info = `‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥–æ–¥–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ù–∞–π–¥–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}.`;
                        }
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º –∏–ª–∏ —è–∑—ã–∫—É
                    if (results.length === 0 && (startYear || endYear || language !== 'all')) {
                        console.log('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –ø—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤...');
                        
                        // –ü—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º –∏ —è–∑—ã–∫—É
                        const urlWithoutYearFilters = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=${perPage}&sort=publication_date:desc&data_version=2&select=id,title,authorships.author.display_name,authorships.author.id,publication_year,primary_location.source.display_name,doi,abstract_inverted_index,abstract,description,summary,biblio.first_page,biblio.last_page,landing_page_url`;
                        
                        try {
                            const responseWithoutFilters = await fetch(urlWithoutYearFilters, {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json',
                                    'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                                }
                            });
                            
                            if (responseWithoutFilters.ok) {
                                const dataWithoutFilters = await responseWithoutFilters.json();
                                let resultsWithoutFilters = dataWithoutFilters.results || [];
                                
                                if (resultsWithoutFilters.length > 0) {
                                    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —è–∑—ã–∫—É –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
                                    let filteredResults = resultsWithoutFilters;
                                    if (language !== 'all') {
                                        filteredResults = filteredResults.filter(work => {
                                            const workLanguage = work.language;
                                            if (!workLanguage) return true; // –ï—Å–ª–∏ —è–∑—ã–∫ –Ω–µ —É–∫–∞–∑–∞–Ω, –≤–∫–ª—é—á–∞–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                            return workLanguage === language;
                                        });
                                    }
                                    
                                    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –≥–æ–¥–∞–º –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
                                    if (startYear || endYear) {
                                        filteredResults = filteredResults.filter(work => {
                                            const year = work.publication_year;
                                            if (!year) return true; // –ï—Å–ª–∏ –≥–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω, –≤–∫–ª—é—á–∞–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                            
                                            if (startYear && endYear) {
                                                return year >= startYear && year <= endYear;
                                            } else if (startYear) {
                                                return year >= startYear;
                                            } else if (endYear) {
                                                return year <= endYear;
                                            }
                                            return true;
                                        });
                                    }
                                    
                                    if (filteredResults.length > 0) {
                                        console.log(`–ù–∞–π–¥–µ–Ω–æ ${filteredResults.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ—Å–ª–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏`);
                                        results = filteredResults.slice(0, targetResults);
                                    } else {
                                        // –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
                                        console.log('–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –≥–æ–¥–∞–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ');
                                        results = resultsWithoutFilters.slice(0, targetResults);
                                        
                                        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                        if (results.length > 0) {
                                            results[0]._warning = `–í —É–∫–∞–∑–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ –≥–æ–¥–æ–≤ (${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}) —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.`;
                                        }
                                    }
                                }
                            }
                        } catch (error) {
                            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', error);
                        }
                    }
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
                    let maxPages = 1; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                    
                    // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ 50 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –¥–µ–ª–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
                    if (targetResults > 50 && data.meta && data.meta.count > perPage) {
                        const totalCount = Math.min(data.meta.count, targetResults);
                        const totalPages = Math.ceil(totalCount / perPage);
                        maxPages = Math.min(totalPages, 10); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 10 —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
                        
                        console.log(`–ù–∞–π–¥–µ–Ω–æ ${totalCount} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –¥–µ–ª–∞–µ–º ${maxPages} –∑–∞–ø—Ä–æ—Å–æ–≤`);
                        
                        // –î–µ–ª–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                        for (let page = 2; page <= maxPages; page++) {
                            try {
                                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                                await new Promise(resolve => setTimeout(resolve, 800));
                                
                                const pageUrl = url + `&page=${page}`;
                                console.log(`–ó–∞–ø—Ä–æ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, pageUrl);
                                
                                const pageResponse = await fetch(pageUrl);
                                
                                if (!pageResponse.ok) {
                                    console.warn(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, pageResponse.status);
                                    break; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª –ø—Ä–∏ –æ—à–∏–±–∫–µ
                                }
                                
                                const pageData = await pageResponse.json();
                                results = results.concat(pageData.results || []);
                                
                                console.log(`–ü–æ–ª—É—á–µ–Ω–æ ${pageData.results?.length || 0} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}`);
                                
                            } catch (error) {
                                console.warn(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, error.message);
                                break; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª –ø—Ä–∏ –æ—à–∏–±–∫–µ
                            }
                        }
                    }
                    
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥–æ–¥–∞–º –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
                    if (startYear || endYear) {
                        const originalLength = results.length;
                        results = results.filter(work => {
                            const year = work.publication_year;
                            if (!year) return true; // –ï—Å–ª–∏ –≥–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω, –≤–∫–ª—é—á–∞–µ–º –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                            
                            if (startYear && endYear) {
                                return year >= parseInt(startYear) && year <= parseInt(endYear);
                            } else if (startYear) {
                                return year >= parseInt(startYear);
                            } else if (endYear) {
                                return year <= parseInt(endYear);
                            }
                            return true;
                        });
                        
                        console.log(`–ü–æ—Å–ª–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: ${originalLength} ‚Üí ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                        
                        // –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞–ª–æ, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö
                        if (results.length < targetResults && results.length < 50) {
                            console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞–ª–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö...');
                            
                            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª—å—à–µ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
                            const additionalPages = Math.min(20, Math.ceil(targetResults / perPage) + 5);
                            
                            for (let page = maxPages + 1; page <= additionalPages; page++) {
                                try {
                                    await new Promise(resolve => setTimeout(resolve, 1000));
                                    
                                    const pageUrl = url + `&page=${page}`;
                                    console.log(`–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, pageUrl);
                                    
                                    const pageResponse = await fetch(pageUrl);
                                    
                                    if (!pageResponse.ok) {
                                        console.warn(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, pageResponse.status);
                                        break;
                                    }
                                    
                                    const pageData = await pageResponse.json();
                                    const newResults = pageData.results || [];
                                    
                                    // –§–∏–ª—å—Ç—Ä—É–µ–º –Ω–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –≥–æ–¥–∞–º
                                    const filteredNewResults = newResults.filter(work => {
                                        const year = work.publication_year;
                                        if (!year) return true;
                                        
                                        if (startYear && endYear) {
                                            return year >= parseInt(startYear) && year <= parseInt(endYear);
                                        } else if (startYear) {
                                            return year >= parseInt(startYear);
                                        } else if (endYear) {
                                            return year <= parseInt(endYear);
                                        }
                                        return true;
                                    });
                                    
                                    results = results.concat(filteredNewResults);
                                    console.log(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${filteredNewResults.length} –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}`);
                                    
                                    // –ï—Å–ª–∏ –Ω–∞–±—Ä–∞–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª
                                    if (results.length >= targetResults) {
                                        console.log(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ —Ü–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${results.length}`);
                                        break;
                                    }
                                    
                                } catch (error) {
                                    console.warn(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${page}:`, error.message);
                                    break;
                                }
                            }
                        }
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫—ç—à
                    this.setCache(cacheKey, results);
                    
                    return results;
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ OpenAlex:', error);
                    
                    if (error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n\n' +
                            '‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º\n' +
                            '‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ CORS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞\n' +
                            '‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–æ–º –∏–ª–∏ —Ñ–∞–π—Ä–≤–æ–ª–æ–º\n' +
                            '‚Ä¢ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å OpenAlex —Å–µ—Ä–≤–µ—Ä–æ–º\n\n' +
                            '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n' +
                            '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n' +
                            '‚Ä¢ –û—Ç–∫–ª—é—á–∏—Ç—å VPN –∏–ª–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å –≤—Ä–µ–º–µ–Ω–Ω–æ\n' +
                            '‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä\n' +
                            '‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É: pavel.alekseev.gasu@gmail.com');
                    }
                    
                    throw error;
                }
            }










            displayResults(results) {
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ API, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                this.results = results;
                this.selectedResults.clear();
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                const resultsCount = document.getElementById('resultsCount');
                const selectionControls = document.getElementById('selectionControls');

                resultsPanel.style.display = 'block';
                resultsPanel.classList.add('active');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
                let countText = `–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${results.length}`;
                resultsCount.textContent = countText;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–±–æ—Ä–æ–º
                if (selectionControls) {
                    selectionControls.style.display = 'flex';
                }

                if (results.length === 0) {
                    resultsList.innerHTML = '<div class="no-results">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.</div>';
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
                let warningHtml = '';
                if (results.length > 0 && results[0]._warning) {
                    warningHtml = `<div class="error" style="margin-bottom: 15px; background: #fff3cd; color: #856404; border-color: #ffeaa7;">
                        <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> ${results[0]._warning}
                    </div>`;
                }

                try {
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–∑—É
                    resultsList.innerHTML = warningHtml + results.map((work, index) => this.formatResult(work, index + 1)).join('');
                    this.updateSelectionCount();
                    this.generateAnalytics(results);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                    console.error('–ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', results.find((work, index) => {
                        try {
                            this.formatResult(work, index + 1);
                            return false;
                        } catch (e) {
                            console.error(`–û—à–∏–±–∫–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ ${index + 1}:`, e);
                            return true;
                        }
                    }));
                    
                    resultsList.innerHTML = warningHtml + '<div class="error">–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.</div>';
                }
            }

            generateAnalytics(results) {
                if (results.length === 0) return;
                
                const analyticsPanel = document.getElementById('analyticsPanel');
                analyticsPanel.style.display = 'block';
                
                // –ê–Ω–∞–ª–∏–∑ –∞–≤—Ç–æ—Ä–æ–≤
                const authors = {};
                results.forEach(work => {
                    work.authorships?.forEach(authorship => {
                        const authorName = authorship?.author?.display_name;
                        if (authorName) {
                            authors[authorName] = (authors[authorName] || 0) + 1;
                        }
                    });
                });
                
                const topAuthors = Object.entries(authors)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);
                
                document.getElementById('topAuthors').innerHTML = topAuthors
                    .map(([name, count]) => `
                        <div class="analytics-item">
                            <span>${name}</span>
                            <span>${count}</span>
                        </div>
                        <div class="analytics-bar">
                            <div class="analytics-bar-fill" style="width: ${(count / topAuthors[0][1]) * 100}%"></div>
                        </div>
                    `).join('');
                
                // –ê–Ω–∞–ª–∏–∑ –∂—É—Ä–Ω–∞–ª–æ–≤
                const journals = {};
                results.forEach(work => {
                    const journalName = work.primary_location?.source?.display_name;
                    if (journalName) {
                        journals[journalName] = (journals[journalName] || 0) + 1;
                    }
                });
                
                const topJournals = Object.entries(journals)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);
                
                document.getElementById('topJournals').innerHTML = topJournals
                    .map(([name, count]) => `
                        <div class="analytics-item">
                            <span>${name.length > 30 ? name.substring(0, 30) + '...' : name}</span>
                            <span>${count}</span>
                        </div>
                        <div class="analytics-bar">
                            <div class="analytics-bar-fill" style="width: ${(count / topJournals[0][1]) * 100}%"></div>
                        </div>
                    `).join('');
                
                // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–æ–¥–∞–º
                const years = {};
                results.forEach(work => {
                    const year = work.publication_year;
                    if (year) {
                        years[year] = (years[year] || 0) + 1;
                    }
                });
                
                const sortedYears = Object.entries(years)
                    .sort(([a], [b]) => b - a)
                    .slice(0, 5);
                
                document.getElementById('yearDistribution').innerHTML = sortedYears
                    .map(([year, count]) => `
                        <div class="analytics-item">
                            <span>${year}</span>
                            <span>${count}</span>
                        </div>
                        <div class="analytics-bar">
                            <div class="analytics-bar-fill" style="width: ${(count / sortedYears[0][1]) * 100}%"></div>
                        </div>
                    `).join('');
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
                const openAccessCount = results.filter(work => work.open_access?.is_oa).length;
                const totalCount = results.length;
                const openAccessPercent = Math.round((openAccessCount / totalCount) * 100);
                
                // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                console.log('=== –ê–ù–ê–õ–ò–ó –û–¢–ö–†–´–¢–û–ì–û –î–û–°–¢–£–ü–ê ===');
                console.log(`–í—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${totalCount}`);
                console.log(`–û—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø: ${openAccessCount} (${openAccessPercent}%)`);
                console.log(`–ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø: ${totalCount - openAccessCount} (${100 - openAccessPercent}%)`);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–æ—Å—Ç—É–ø–∞
                const openAccessExamples = results.filter(work => work.open_access?.is_oa).slice(0, 3);
                const closedAccessExamples = results.filter(work => !work.open_access?.is_oa).slice(0, 3);
                
                console.log('–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:', openAccessExamples.map(w => ({
                    title: w.title?.substring(0, 50) + '...',
                    is_oa: w.open_access?.is_oa,
                    oa_url: w.open_access?.oa_url,
                    oa_status: w.open_access?.oa_status
                })));
                
                console.log('–ü—Ä–∏–º–µ—Ä—ã –ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:', closedAccessExamples.map(w => ({
                    title: w.title?.substring(0, 50) + '...',
                    is_oa: w.open_access?.is_oa,
                    oa_url: w.open_access?.oa_url,
                    oa_status: w.open_access?.oa_status
                })));
                
                console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê –û–¢–ö–†–´–¢–û–ì–û –î–û–°–¢–£–ü–ê ===');
                
                document.getElementById('openAccessStats').innerHTML = `
                    <div class="analytics-item">
                        <span>–û—Ç–∫—Ä—ã—Ç—ã–π –¥–æ—Å—Ç—É–ø</span>
                        <span>${openAccessCount} (${openAccessPercent}%)</span>
                    </div>
                    <div class="analytics-bar">
                        <div class="analytics-bar-fill" style="width: ${openAccessPercent}%"></div>
                    </div>
                    <div class="analytics-item">
                        <span>–ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø</span>
                        <span>${totalCount - openAccessCount} (${100 - openAccessPercent}%)</span>
                    </div>
                    <div class="analytics-bar">
                        <div class="analytics-bar-fill" style="width: ${100 - openAccessPercent}%; background: var(--accent-secondary);"></div>
                    </div>
                `;
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è HTML-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
            sanitizeHtml(html) {
                if (!html) return '';
                
                // –ü—Ä–æ—Å—Ç–∞—è –æ—á–∏—Å—Ç–∫–∞ HTML - —É–¥–∞–ª—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ —Ç–µ–≥–∏
                // –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–µ–≥–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                let cleanedHtml = html
                    // –£–¥–∞–ª—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ —Ç–µ–≥–∏
                    .replace(/<script[^>]*>.*?<\/script>/gi, '')
                    .replace(/<iframe[^>]*>.*?<\/iframe>/gi, '')
                    .replace(/<object[^>]*>.*?<\/object>/gi, '')
                    .replace(/<embed[^>]*>.*?<\/embed>/gi, '')
                    .replace(/<link[^>]*>/gi, '')
                    .replace(/<meta[^>]*>/gi, '')
                    .replace(/<style[^>]*>.*?<\/style>/gi, '')
                    // –£–¥–∞–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã onclick, onload –∏ –¥—Ä—É–≥–∏–µ —Å–æ–±—ã—Ç–∏—è
                    .replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '')
                    // –£–¥–∞–ª—è–µ–º javascript: —Å—Å—ã–ª–∫–∏
                    .replace(/javascript:/gi, '')
                    // –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ —Ç–µ–≥–∏
                    .replace(/<(\w+)[^>]*>\s*<\/\1>/gi, '')
                    // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã
                    .replace(/<p[^>]*>\s*<\/p>/gi, '')
                    // –£–¥–∞–ª—è–µ–º –ø—É—Å—Ç—ã–µ span'—ã
                    .replace(/<span[^>]*>\s*<\/span>/gi, '');
                
                // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø—É—Å—Ç—ã–µ —Ç–µ–≥–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç –±–µ–∑ —Ç–µ–≥–æ–≤
                const textOnly = cleanedHtml.replace(/<[^>]*>/g, '').trim();
                if (textOnly.length === 0) {
                    return '';
                }
                
                return cleanedHtml;
            }

            formatResult(work, index) {
                console.log(`\n=== FORMATTING RESULT ${index} ===`);
                console.log('Work object:', work);
                console.log('Work keys:', Object.keys(work));
                console.log('Biblio data:', work.biblio);
                console.log('Page info:', {
                    first_page: work.biblio?.first_page,
                    last_page: work.biblio?.last_page,
                    pages: work.pages
                });
                console.log('Authorships:', work.authorships);
                console.log('Primary location:', work.primary_location);
                
                const title = work.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                
                    // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–æ–≤ —Å –æ—Ç–ª–∞–¥–∫–æ–π
                console.log('=== –û–¢–õ–ê–î–ö–ê –ê–í–¢–û–†–û–í ===');
                console.log('Work data for authors:', work);
                console.log('Authorships:', work.authorships);
                console.log('Work.authors:', work.authors);
                console.log('Work.author:', work.author);
                console.log('All work keys:', Object.keys(work));
                
                let authors = '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                
                if (work.authorships && work.authorships.length > 0) {
                    const authorNames = work.authorships
                        .map(authorship => {
                            console.log('Authorship:', authorship);
                            return authorship?.author?.display_name || 
                                   authorship?.author?.name ||
                                   authorship?.author?.title ||
                                   authorship?.display_name;
                        })
                        .filter(name => name && name.trim() !== '');
                    
                    console.log('Extracted author names:', authorNames);
                    
                    if (authorNames.length > 0) {
                        authors = authorNames.join(', ');
                    }
                } else if (work.authors && work.authors.length > 0) {
                    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∞–≤—Ç–æ—Ä–æ–≤
                    const authorNames = work.authors
                        .map(author => author?.display_name || author?.name || author?.title)
                        .filter(name => name && name.trim() !== '');
                    
                    if (authorNames.length > 0) {
                        authors = authorNames.join(', ');
                    }
                } else if (work.author) {
                    // –ï–¥–∏–Ω–∏—á–Ω—ã–π –∞–≤—Ç–æ—Ä
                    authors = work.author.display_name || work.author.name || work.author.title || '–ê–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω';
                } else {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ª—è
                    console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤...');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ª—è
                    const possibleAuthorFields = [
                        'creator', 'creators', 'contributor', 'contributors',
                        'writer', 'writers', 'researcher', 'researchers',
                        'author_name', 'author_names', 'author_list', 'authors_list'
                    ];
                    
                    for (const field of possibleAuthorFields) {
                        if (work[field]) {
                            console.log(`–ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ ${field}:`, work[field]);
                            if (Array.isArray(work[field])) {
                                const names = work[field].map(item => 
                                    typeof item === 'string' ? item : 
                                    item?.name || item?.display_name || item?.title
                                ).filter(name => name && name.trim() !== '');
                                
                                if (names.length > 0) {
                                    authors = names.join(', ');
                                    console.log(`–ê–≤—Ç–æ—Ä—ã –∏–∑ –ø–æ–ª—è ${field}:`, authors);
                                    break;
                                }
                            } else if (typeof work[field] === 'string') {
                                authors = work[field];
                                console.log(`–ê–≤—Ç–æ—Ä –∏–∑ –ø–æ–ª—è ${field}:`, authors);
                                break;
                            }
                        }
                    }
                }
                
                console.log('Final authors:', authors);
                const journal = work.primary_location?.source?.display_name || '–ñ—É—Ä–Ω–∞–ª –Ω–µ —É–∫–∞–∑–∞–Ω';
                const year = work.publication_year || '–ì–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω';
                    
                    // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
                    console.log('Abstract fields available:', {
                        'abstract_inverted_index': work.abstract_inverted_index,
                        'abstract': work.abstract,
                        'description': work.description,
                        'summary': work.summary
                    });
                    
                let abstract;
                    if (work.abstract_inverted_index) {
                        abstract = this.reconstructAbstract(work.abstract_inverted_index);
                        console.log('Reconstructed abstract length:', abstract.length);
                    } else if (work.abstract) {
                        abstract = work.abstract;
                        console.log('Direct abstract length:', abstract.length);
                    } else if (work.description) {
                        abstract = work.description;
                        console.log('Description used as abstract, length:', abstract.length);
                    } else if (work.summary) {
                        abstract = work.summary;
                        console.log('Summary used as abstract, length:', abstract.length);
                    } else {
                        abstract = '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                        console.log('No abstract found');
                    }
                    
                const doi = work.doi;
                const linkUrl = work.landing_page_url || work.id || '#';

                const resultIndex = index - 1;
                
                return `
                    <div class="result-item" data-index="${resultIndex}">
                            <input type="checkbox" class="result-checkbox" data-index="${resultIndex}" onchange="window.sciSearcher.toggleSelection(${resultIndex})">
                        <div class="result-title">${title}</div>
                        <div class="result-authors">${authors}</div>
                        <div class="result-journal">${journal}</div>
                        <div class="result-year">–ì–æ–¥: ${year}</div>
                        ${work.biblio?.first_page ? `
                            <div class="result-pages" style="color: #27ae60; font-size: 0.8rem; margin-bottom: 6px;">
                                üìÑ –°—Ç—Ä–∞–Ω–∏—Ü—ã: ${work.biblio.first_page}${work.biblio.last_page && work.biblio.first_page !== work.biblio.last_page ? `‚Äì${work.biblio.last_page}` : ''}
                            </div>
                        ` : work.biblio?.volume ? `
                            <div class="result-pages" style="color: #f39c12; font-size: 0.8rem; margin-bottom: 6px;">
                                üìñ –¢–æ–º ${work.biblio.volume}${work.biblio.issue ? `, ‚Ññ ${work.biblio.issue}` : ''} (—Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã)
                            </div>
                        ` : ''}
                        ${abstract && abstract !== '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞' ? `
                            <div class="result-abstract abstract-preview" id="abstract-${resultIndex}">
                                ${this.sanitizeHtml(abstract)}
                            </div>
                                <button class="toggle-abstract" onclick="window.sciSearcher.toggleAbstract(${resultIndex})">
                                    –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
                                </button>
                        ` : ''}
                        ${doi ? `<div class="result-doi">DOI: <a href="${doi.startsWith('https://doi.org/') ? doi : `https://doi.org/${doi}`}" target="_blank">${doi.replace('https://doi.org/', '')}</a></div>` : ''}
                        <a href="${linkUrl}" target="_blank" class="result-link">
                            üîó –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å—Ç–∞—Ç—å–µ
                        </a>
                    </div>
                `;
            }

            reconstructAbstract(abstractIndex) {
                if (!abstractIndex) return '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                
                console.log('Reconstructing abstract from index:', abstractIndex);
                
                try {
                    const words = [];
                    for (const [word, positions] of Object.entries(abstractIndex)) {
                        if (Array.isArray(positions)) {
                            positions.forEach(pos => {
                                words[pos] = word;
                            });
                        }
                    }
                    
                    // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—É—Å—Ç—ã–µ —Å–ª–æ—Ç—ã –∏ —Å–æ–µ–¥–∏–Ω—è–µ–º —Å–ª–æ–≤–∞
                    const fullText = words.filter(word => word !== undefined).join(' ');
                    console.log('Reconstructed abstract full text length:', fullText.length);
                    console.log('First 200 chars:', fullText.substring(0, 200));
                    
                    return fullText || '–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                } catch (error) {
                    console.error('Error reconstructing abstract:', error);
                    return '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏';
                }
            }

            toggleSelection(index) {
                const checkbox = document.querySelector(`input[data-index="${index}"]`);
                const resultItem = document.querySelector(`.result-item[data-index="${index}"]`);
                
                if (checkbox.checked) {
                    this.selectedResults.add(index);
                    resultItem.classList.add('selected');
                } else {
                    this.selectedResults.delete(index);
                    resultItem.classList.remove('selected');
                }
                
                this.updateSelectionCount();
            }

            toggleAbstract(index) {
                const abstractElement = document.getElementById(`abstract-${index}`);
                const button = document.querySelector(`button[onclick="window.sciSearcher.toggleAbstract(${index})"]`);
                
                if (abstractElement.classList.contains('abstract-preview')) {
                    abstractElement.classList.remove('abstract-preview');
                    abstractElement.classList.add('abstract-full');
                    button.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å';
                } else {
                    abstractElement.classList.remove('abstract-full');
                    abstractElement.classList.add('abstract-preview');
                    button.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é';
                }
            }

            selectAllResults() {
                this.selectedResults.clear();
                const checkboxes = document.querySelectorAll('.result-checkbox');
                const resultItems = document.querySelectorAll('.result-item');
                
                checkboxes.forEach((checkbox, index) => {
                    checkbox.checked = true;
                    this.selectedResults.add(index);
                    resultItems[index].classList.add('selected');
                });
                
                this.updateSelectionCount();
            }

            clearSelection() {
                this.selectedResults.clear();
                const checkboxes = document.querySelectorAll('.result-checkbox');
                const resultItems = document.querySelectorAll('.result-item');
                
                checkboxes.forEach((checkbox, index) => {
                    checkbox.checked = false;
                    resultItems[index].classList.remove('selected');
                });
                
                this.updateSelectionCount();
            }

            updateSelectionCount() {
                const selectedCount = document.getElementById('selectedCount');
                const selectAllCheckbox = document.getElementById('selectAllCheckbox');
                const downloadSelectedApaBtn = document.getElementById('downloadSelectedApaBtn');
                const downloadSelectedGostBtn = document.getElementById('downloadSelectedGostBtn');
                const downloadSelectedTxtBtn = document.getElementById('downloadSelectedTxtBtn');
                
                if (selectedCount) {
                    selectedCount.textContent = `–í—ã–±—Ä–∞–Ω–æ: ${this.selectedResults.size}`;
                }
                
                if (selectAllCheckbox) {
                    selectAllCheckbox.checked = this.selectedResults.size === this.results.length && this.results.length > 0;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
                const hasSelected = this.selectedResults.size > 0;
                if (downloadSelectedApaBtn) downloadSelectedApaBtn.style.display = hasSelected ? 'flex' : 'none';
                if (downloadSelectedGostBtn) downloadSelectedGostBtn.style.display = hasSelected ? 'flex' : 'none';
                if (downloadSelectedTxtBtn) downloadSelectedTxtBtn.style.display = hasSelected ? 'flex' : 'none';
            }

            downloadSelectedResults(format = 'txt') {
                if (this.selectedResults.size === 0) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø—É–±–ª–∏–∫–∞—Ü–∏—é –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–µ–∫–±–æ–∫—Å—ã —Ä—è–¥–æ–º —Å –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞.');
                    return;
                }
                
                const selectedResults = Array.from(this.selectedResults).map(index => this.results[index]);
                console.log(`–°–∫–∞—á–∏–≤–∞–Ω–∏–µ ${selectedResults.length} –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format.toUpperCase()}`);
                this.downloadResults(format, selectedResults);
            }

            showLoading() {
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                const resultsLimit = document.getElementById('resultsLimit').value;
                
                resultsPanel.style.display = 'block';
                
                let loadingMessage = '–ü–æ–∏—Å–∫ –Ω–∞—É—á–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π...';
                if (parseInt(resultsLimit) >= 300) {
                    loadingMessage = '–ü–æ–∏—Å–∫ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π...<br><small style="color: #666;">–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥</small>';
                } else if (parseInt(resultsLimit) >= 200) {
                    loadingMessage = '–ü–æ–∏—Å–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π...<br><small style="color: #666;">–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 15-30 —Å–µ–∫—É–Ω–¥</small>';
                }
                
                resultsList.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>${loadingMessage}</div>
                    </div>
                `;
            }

            showError(message) {
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                
                resultsPanel.style.display = 'block';
                resultsList.innerHTML = `
                    <div class="error">
                        ${message.replace(/\n/g, '<br>')}
                        <div style="margin-top: 15px;">
                            <button class="search-btn" onclick="window.sciSearcher.retrySearch()" style="margin-right: 10px;">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                            <button class="search-btn" onclick="window.sciSearcher.tryAlternativeSearch()" style="background: #28a745; margin-right: 10px;">
                                üîç –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ (25 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
                            </button>
                            <button class="search-btn" onclick="window.sciSearcher.searchWithoutYearFilters()" style="background: #6f42c1; margin-right: 10px;">
                                üìÖ –ü–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º
                            </button>
                            <button class="search-btn" onclick="window.sciSearcher.runDiagnostics()" style="background: #17a2b8;">
                                üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
                            </button>
                        </div>
                    </div>
                `;
            }

            downloadResults(format = 'txt', selectedResults = null) {
                const resultsToDownload = selectedResults || this.results;
                
                if (resultsToDownload.length === 0) {
                    alert('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                    return;
                }

                let text, filename;
                
                switch(format) {
                    case 'apa':
                        text = this.formatResultsForAPA(resultsToDownload);
                        filename = `sci-search-results-apa-${new Date().toISOString().split('T')[0]}.txt`;
                        break;
                    case 'gost':
                        text = this.formatResultsForGOST(resultsToDownload);
                        filename = `sci-search-results-gost-${new Date().toISOString().split('T')[0]}.txt`;
                        break;
                    case 'bibtex':
                        text = this.formatResultsForBibTeX(resultsToDownload);
                        filename = `sci-search-results-bibtex-${new Date().toISOString().split('T')[0]}.bib`;
                        break;
                    default:
                        text = this.formatResultsForExport(resultsToDownload);
                        filename = `sci-search-results-${new Date().toISOString().split('T')[0]}.txt`;
                }

                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            copyResults() {
                if (this.results.length === 0) {
                    alert('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                    return;
                }

                const text = this.formatResultsForExport();
                navigator.clipboard.writeText(text).then(() => {
                    alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª.');
                });
            }

            formatResultsForExport(results = null) {
                const resultsToFormat = results || this.results;
                const keywords = document.getElementById('keywords').value;
                const startYear = document.getElementById('startYear').value;
                const endYear = document.getElementById('endYear').value;
                
                let text = `–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê –ù–ê–£–ß–ù–û–ô –õ–ò–¢–ï–†–ê–¢–£–†–´\n`;
                text += `–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: ${keywords}\n`;
                if (startYear || endYear) {
                    text += `–ü–µ—Ä–∏–æ–¥: ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\n`;
                }
                text += `–î–∞—Ç–∞ –ø–æ–∏—Å–∫–∞: ${new Date().toLocaleString('ru-RU')}\n`;
                text += `–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${resultsToFormat.length}\n\n`;
                text += `========================================\n\n`;

                resultsToFormat.forEach((work, index) => {
                    const title = work.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    
                    // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                    let authors = '–ê–≤—Ç–æ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                    
                    if (work.authorships && work.authorships.length > 0) {
                        const authorNames = work.authorships
                            .map(authorship => authorship?.author?.display_name || 
                                               authorship?.author?.name ||
                                               authorship?.author?.title ||
                                               authorship?.display_name)
                            .filter(name => name && name.trim() !== '');
                        
                        if (authorNames.length > 0) {
                            authors = authorNames.join(', ');
                        }
                    } else if (work.authors && work.authors.length > 0) {
                        const authorNames = work.authors
                            .map(author => author?.display_name || author?.name || author?.title)
                            .filter(name => name && name.trim() !== '');
                        
                        if (authorNames.length > 0) {
                            authors = authorNames.join(', ');
                        }
                    } else if (work.author) {
                        authors = work.author.display_name || work.author.name || work.author.title || '–ê–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω';
                    }
                    
                    const journal = work.primary_location?.source?.display_name || '–ñ—É—Ä–Ω–∞–ª –Ω–µ —É–∫–∞–∑–∞–Ω';
                    const year = work.publication_year || '–ì–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω';
                    const doi = work.doi || work.id;

                    text += `${index + 1}. ${title}\n`;
                    text += `–ê–≤—Ç–æ—Ä—ã: ${authors}\n`;
                    text += `–ñ—É—Ä–Ω–∞–ª: ${journal}\n`;
                    text += `–ì–æ–¥: ${year}\n`;
                    text += `DOI: ${doi}\n\n`;
                });

                return text;
            }

            formatResultsForAPA(results = null) {
                const resultsToFormat = results || this.results;
                    const keywords = document.getElementById('keywords').value;
                    const startYear = document.getElementById('startYear').value;
                    const endYear = document.getElementById('endYear').value;
                
                let searchInfo = `Search keywords: ${keywords}\n`;
                    if (startYear || endYear) {
                        searchInfo += `Publication period: ${startYear || 'not specified'} - ${endYear || 'not specified'}\n`;
                }
                
                let text = `REFERENCES (APA FORMAT)\n`;
                text += searchInfo;
                text += `Search date: ${new Date().toLocaleString('en-US')}\n`;
                text += `Total results: ${resultsToFormat.length}\n\n`;

                resultsToFormat.forEach((work, index) => {
                    const title = work.title || 'Untitled';
                    const year = work.publication_year || work.year || 'n.d.';
                    const doi = work.doi || '';
                    const volume = work.biblio?.volume || work.volume || '';
                    const issue = work.biblio?.issue || work.issue || '';
                    // Format pages with range (first_page - last_page)
                    // OpenAlex API provides first_page and last_page in biblio object
                    // If both are available and different, show range (e.g., "215‚Äì220")
                    // If only first_page is available, show single page
                    // If no page info is available, pages remains empty
                    let pages = '';
                    const firstPage = work.biblio?.first_page || '';
                    const lastPage = work.biblio?.last_page || '';
                    if (firstPage && lastPage && firstPage !== lastPage) {
                        pages = `${firstPage}‚Äì${lastPage}`;
                    } else if (firstPage) {
                        pages = firstPage;
                    } else if (work.pages) {
                        pages = work.pages;
                    }

                    // Format authors in APA style with better null checks
                    let authorString = '';
                    const authors = work.authorships || [];
                    
                    if (authors.length === 0) {
                        // –ü–æ–ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∞–≤—Ç–æ—Ä–æ–≤
                        if (work.authors && work.authors.length > 0) {
                            const validAuthors = work.authors
                                .map(author => author?.display_name || author?.name || author?.title)
                                .filter(name => name && name.trim() !== '');
                            
                            if (validAuthors.length > 0) {
                                if (validAuthors.length === 1) {
                                    const name = validAuthors[0];
                                    const lastName = name.split(',')[0] || name.split(' ').pop();
                                    const firstName = name.split(',')[1]?.trim() || name.split(' ')[0];
                                    authorString = `${lastName}, ${firstName.charAt(0).toUpperCase()}.`;
                                } else if (validAuthors.length <= 7) {
                                    const formattedAuthors = validAuthors.map(name => {
                                        const lastName = name.split(',')[0] || name.split(' ').pop();
                                        const firstName = name.split(',')[1]?.trim() || name.split(' ')[0];
                                        return `${lastName}, ${firstName.charAt(0).toUpperCase()}.`;
                                    });
                                    authorString = formattedAuthors.join(', ');
                                } else {
                                    const firstAuthor = validAuthors[0];
                                    const lastName = firstAuthor.split(',')[0] || firstAuthor.split(' ').pop();
                                    const firstName = firstAuthor.split(',')[1]?.trim() || firstAuthor.split(' ')[0];
                                    authorString = `${lastName}, ${firstName.charAt(0).toUpperCase()}., et al.`;
                                }
                            } else {
                                authorString = 'Anonymous';
                            }
                        } else {
                            authorString = 'Anonymous';
                        }
                    } else {
                        const validAuthors = authors
                            .map(authorship => authorship?.author?.display_name || 
                                               authorship?.author?.name ||
                                               authorship?.author?.title ||
                                               authorship?.display_name)
                            .filter(name => name && name.trim() !== '');
                        
                        if (validAuthors.length === 0) {
                            authorString = 'Anonymous';
                        } else if (validAuthors.length === 1) {
                            const name = validAuthors[0];
                            const lastName = name.split(',')[0] || name.split(' ').pop();
                            const firstName = name.split(',')[1]?.trim() || name.split(' ')[0];
                            authorString = `${lastName}, ${firstName.charAt(0).toUpperCase()}.`;
                        } else if (validAuthors.length <= 7) {
                            const formattedAuthors = validAuthors.map(name => {
                                const lastName = name.split(',')[0] || name.split(' ').pop();
                                const firstName = name.split(',')[1]?.trim() || name.split(' ')[0];
                                return `${lastName}, ${firstName.charAt(0).toUpperCase()}.`;
                            });
                            authorString = formattedAuthors.join(', ');
                        } else {
                            const firstAuthor = validAuthors[0];
                            const lastName = firstAuthor.split(',')[0] || firstAuthor.split(' ').pop();
                            const firstName = firstAuthor.split(',')[1]?.trim() || firstAuthor.split(' ')[0];
                            authorString = `${lastName}, ${firstName.charAt(0).toUpperCase()}., et al.`;
                        }
                    }

                    // Format journal info
                    const journal = work.primary_location?.source?.display_name || 'Unknown Journal';
                    let journalInfo = journal;
                    if (volume) {
                        journalInfo += `, ${volume}`;
                        if (issue) {
                            journalInfo += `(${issue})`;
                        }
                        if (pages) {
                            journalInfo += `, ${pages}`;
                        } else {
                            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–º/–Ω–æ–º–µ—Ä, –Ω–æ –Ω–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü, –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ
                            journalInfo += `, [pages not specified]`;
                        }
                    }

                    // Construct APA reference
                    text += `${authorString} (${year}). ${title}. ${journalInfo}`;
                    if (doi) {
                        // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ https://doi.org/ –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –µ—Å—Ç—å
                        const cleanDoi = doi.startsWith('https://doi.org/') ? doi : `https://doi.org/${doi}`;
                        text += `. ${cleanDoi}`;
                    }
                    text += '.\n\n';
                });

                return text;
            }


            formatResultsForGOST(results = null) {
                const resultsToFormat = results || this.results;
                    const keywords = document.getElementById('keywords').value;
                    const startYear = document.getElementById('startYear').value;
                    const endYear = document.getElementById('endYear').value;
                
                let searchInfo = `–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ–∏—Å–∫–∞: ${keywords}\n`;
                    if (startYear || endYear) {
                        searchInfo += `–ü–µ—Ä–∏–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: ${startYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'} - ${endYear || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\n`;
                }
                
                let text = `–°–ü–ò–°–û–ö –õ–ò–¢–ï–†–ê–¢–£–†–´ (–ì–û–°–¢ 7.1-2003)\n`;
                text += searchInfo;
                text += `–î–∞—Ç–∞ –ø–æ–∏—Å–∫–∞: ${new Date().toLocaleString('ru-RU')}\n`;
                text += `–í—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${resultsToFormat.length}\n\n`;

                resultsToFormat.forEach((work, index) => {
                    const title = work.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                    const year = work.publication_year || work.year || '–±.–≥.';
                    const doi = work.doi || '';
                    const volume = work.biblio?.volume || work.volume || '';
                    const issue = work.biblio?.issue || work.issue || '';
                    // Format pages with range (first_page - last_page)
                    // OpenAlex API provides first_page and last_page in biblio object
                    // If both are available and different, show range (e.g., "215‚Äì220")
                    // If only first_page is available, show single page
                    // If no page info is available, pages remains empty
                    let pages = '';
                    const firstPage = work.biblio?.first_page || '';
                    const lastPage = work.biblio?.last_page || '';
                    if (firstPage && lastPage && firstPage !== lastPage) {
                        pages = `${firstPage}‚Äì${lastPage}`;
                    } else if (firstPage) {
                        pages = firstPage;
                    } else if (work.pages) {
                        pages = work.pages;
                    }

                    // Format authors in GOST style with better null checks
                    let authorString = '';
                    const authors = work.authorships || [];
                    
                    if (authors.length === 0) {
                        authorString = '–ê–Ω–æ–Ω–∏–º';
                    } else {
                        const validAuthors = authors
                            .map(authorship => authorship?.author?.display_name)
                            .filter(name => name && name.trim() !== '');
                        
                        if (validAuthors.length === 0) {
                            authorString = '–ê–Ω–æ–Ω–∏–º';
                        } else if (validAuthors.length === 1) {
                            authorString = validAuthors[0];
                        } else if (validAuthors.length <= 3) {
                            authorString = validAuthors.join(', ');
                        } else {
                            authorString = `${validAuthors[0]} [–∏ –¥—Ä.]`;
                        }
                    }

                    // Format journal info
                    const journal = work.primary_location?.source?.display_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∂—É—Ä–Ω–∞–ª';
                    let journalInfo = journal;
                    if (volume) {
                        journalInfo += `. ‚Äì ${year}. ‚Äì –¢. ${volume}`;
                        if (issue) {
                            journalInfo += `, ‚Ññ ${issue}`;
                        }
                        if (pages) {
                            journalInfo += `. ‚Äì –°. ${pages}`;
                        } else {
                            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–º/–Ω–æ–º–µ—Ä, –Ω–æ –Ω–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü, –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ
                            journalInfo += `. ‚Äì [–°—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã]`;
                        }
                    } else {
                        journalInfo += `. ‚Äì ${year}`;
                    }

                    // Construct GOST reference
                    text += `${authorString} ${title} // ${journalInfo}`;
                    if (doi) {
                        // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ https://doi.org/ –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –µ—Å—Ç—å
                        const cleanDoi = doi.startsWith('https://doi.org/') ? doi : `https://doi.org/${doi}`;
                        text += `. ‚Äì DOI: ${cleanDoi}`;
                    }
                    text += '.\n\n';
                });

                return text;
            }

            formatResultsForBibTeX(results = null) {
                const resultsToFormat = results || this.results;
                
                let text = `% BibTeX entries generated by Sci-Searcher\n`;
                text += `% Generated on: ${new Date().toLocaleString('en-US')}\n`;
                text += `% Total entries: ${resultsToFormat.length}\n\n`;

                resultsToFormat.forEach((work, index) => {
                    const title = work.title || 'Untitled';
                    const year = work.publication_year || work.year || 'n.d.';
                    const doi = work.doi || '';
                    const volume = work.biblio?.volume || work.volume || '';
                    const issue = work.biblio?.issue || work.issue || '';
                    
                    // Format pages with range
                    let pages = '';
                    const firstPage = work.biblio?.first_page || '';
                    const lastPage = work.biblio?.last_page || '';
                    if (firstPage && lastPage && firstPage !== lastPage) {
                        pages = `${firstPage}--${lastPage}`;
                    } else if (firstPage) {
                        pages = firstPage;
                    } else if (work.pages) {
                        pages = work.pages;
                    }

                    // Format authors
                    let authorString = '';
                    const authors = work.authorships || [];
                    
                    if (authors.length === 0) {
                        authorString = 'Anonymous';
                    } else {
                        const validAuthors = authors
                            .map(authorship => authorship?.author?.display_name)
                            .filter(name => name && name.trim() !== '');
                        
                        if (validAuthors.length === 0) {
                            authorString = 'Anonymous';
                        } else {
                            authorString = validAuthors.join(' and ');
                        }
                    }

                    // Journal name
                    const journal = work.primary_location?.source?.display_name || 'Unknown Journal';
                    
                    // Generate BibTeX key
                    const bibtexKey = `work${index + 1}_${year}`;
                    
                    // Determine entry type
                    const sourceType = work.primary_location?.source?.type;
                    let entryType = 'article';
                    if (sourceType === 'book' || sourceType === 'monograph') {
                        entryType = 'book';
                    } else if (sourceType === 'proceedings') {
                        entryType = 'inproceedings';
                    }

                    text += `@${entryType}{${bibtexKey},\n`;
                    text += `  title = {${title}},\n`;
                    text += `  author = {${authorString}},\n`;
                    text += `  journal = {${journal}},\n`;
                    text += `  year = {${year}},\n`;
                    
                    if (volume) {
                        text += `  volume = {${volume}},\n`;
                    }
                    if (issue) {
                        text += `  number = {${issue}},\n`;
                    }
                    if (pages) {
                        text += `  pages = {${pages}},\n`;
                    }
                    if (doi) {
                        text += `  doi = {${doi}},\n`;
                    }
                    
                    text += `}\n\n`;
                });

                return text;
            }

            async checkApiStatus() {
                const statusElement = document.getElementById('apiStatus');
                
                try {
                    // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ OpenAlex API
                    const response = await fetch('https://api.openalex.org/works?search=test&per-page=1', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                        }
                    });
                    
                    if (response.ok) {
                        statusElement.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω ‚úÖ';
                        statusElement.style.color = '#28a745';
                    } else if (response.status === 403) {
                        statusElement.textContent = '–û–≥—Ä–∞–Ω–∏—á–µ–Ω ‚ö†Ô∏è';
                        statusElement.style.color = '#ffc107';
                    } else {
                        statusElement.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ ‚ö†Ô∏è';
                        statusElement.style.color = '#ffc107';
                    }
                } catch (error) {
                    if (error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                        statusElement.textContent = '–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ ‚ùå';
                        statusElement.style.color = '#dc3545';
                    } else {
                        statusElement.textContent = '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚ùå';
                        statusElement.style.color = '#dc3545';
                    }
                }
            }

            retrySearch() {
                // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–∏—Å–∫
                const form = document.getElementById('openalexForm');
                const event = new Event('submit');
                form.dispatchEvent(event);
            }

            async tryAlternativeSearch() {
                // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                const keywords = document.getElementById('keywords').value.trim();
                
                if (!keywords) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                    return;
                }

                this.showLoading();
                
                try {
                    // –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º –∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    const url = `https://api.openalex.org/works?search=${encodeURIComponent(keywords)}&per-page=25&sort=publication_date:desc&data_version=2&select=id,title,authorships.author.display_name,authorships.author.id,publication_year,primary_location.source.display_name,doi,abstract_inverted_index,abstract,description,summary,biblio.first_page,biblio.last_page,landing_page_url`;
                    
                    console.log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ URL:', url);
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —É—Å–ø–µ—à–µ–Ω:', data);
                        this.displayResults(data.results || []);
                } else {
                        throw new Error(`–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Ç–∞–∫–∂–µ –Ω–µ —É–¥–∞–ª—Å—è. –°—Ç–∞—Ç—É—Å: ${response.status}`);
                    }
                } catch (error) {
                    if (error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                        this.showError('–û—à–∏–±–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:\n\n' +
                            '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n' +
                            '‚Ä¢ –û—Ç–∫–ª—é—á–∏—Ç—å VPN –∏–ª–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å –≤—Ä–µ–º–µ–Ω–Ω–æ\n' +
                            '‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä\n' +
                            '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞\n' +
                            '‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É\n' +
                            '‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç—ã: pavel.alekseev.gasu@gmail.com');
                    } else {
                        this.showError('–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ–∏—Å–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:\n\n' +
                            '‚Ä¢ –ü–æ–¥–æ–∂–¥–∞—Ç—å 10-15 –º–∏–Ω—É—Ç –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É\n' +
                            '‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n' +
                            '‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É\n' +
                            '‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPN –¥–ª—è —Å–º–µ–Ω—ã IP-–∞–¥—Ä–µ—Å–∞');
                    }
                }
            }

            async searchWithoutYearFilters() {
                // –ü–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º
                const keywords = document.getElementById('keywords').value.trim();
                const resultsLimit = document.getElementById('resultsLimit').value;
                
                if (!keywords) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                    return;
                }

                this.showLoading();
                
                try {
                    // –ü–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –≥–æ–¥–∞–º
                    const results = await this.searchOpenAlex(keywords, '', '', resultsLimit);
                    this.displayResults(results);
                } catch (error) {
                    this.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤: ' + error.message);
                }
            }

            async runDiagnostics() {
                const resultsPanel = document.getElementById('resultsPanel');
                const resultsList = document.getElementById('resultsList');
                
                resultsList.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>–ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...</div>
                    </div>
                `;
                
                const diagnostics = [];
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ë–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
                try {
                    const testResponse = await fetch('https://httpbin.org/get', { method: 'GET' });
                    if (testResponse.ok) {
                        diagnostics.push('‚úÖ –ë–∞–∑–æ–≤–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç');
                    } else {
                        diagnostics.push('‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–≤—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º');
                    }
                } catch (error) {
                    diagnostics.push('‚ùå –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OpenAlex API
                try {
                    const openAlexResponse = await fetch('https://api.openalex.org/works?search=test&per-page=1&data_version=2', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'Sci-Searcher/1.0 (Educational Research Tool)'
                        }
                    });
                    
                    if (openAlexResponse.ok) {
                        diagnostics.push('‚úÖ OpenAlex API –¥–æ—Å—Ç—É–ø–µ–Ω');
                    } else if (openAlexResponse.status === 403) {
                        diagnostics.push('‚ö†Ô∏è OpenAlex API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω (—Å—Ç–∞—Ç—É—Å: 403)');
                    } else {
                        diagnostics.push(`‚ùå OpenAlex API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Å—Ç–∞—Ç—É—Å: ${openAlexResponse.status})`);
                    }
                } catch (error) {
                    if (error.message.includes('Failed to fetch')) {
                        diagnostics.push('‚ùå –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ OpenAlex API (CORS –∏–ª–∏ —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)');
                    } else {
                        diagnostics.push(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ OpenAlex API: ${error.message}`);
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ
                const userAgent = navigator.userAgent;
                const isChrome = userAgent.includes('Chrome');
                const isFirefox = userAgent.includes('Firefox');
                const isSafari = userAgent.includes('Safari') && !userAgent.includes('Chrome');
                const isEdge = userAgent.includes('Edge');
                
                let browserInfo = '';
                if (isChrome) browserInfo = 'Chrome';
                else if (isFirefox) browserInfo = 'Firefox';
                else if (isSafari) browserInfo = 'Safari';
                else if (isEdge) browserInfo = 'Edge';
                else browserInfo = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä';
                
                diagnostics.push(`‚ÑπÔ∏è –ë—Ä–∞—É–∑–µ—Ä: ${browserInfo}`);
                diagnostics.push(`‚ÑπÔ∏è User Agent: ${userAgent.substring(0, 100)}...`);
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
                resultsList.innerHTML = `
                    <div class="error">
                        <h3>üîß –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</h3>
                        <div style="text-align: left; margin: 20px 0;">
                            ${diagnostics.map(d => `<div style="margin: 10px 0;">${d}</div>`).join('')}
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="search-btn" onclick="window.sciSearcher.retrySearch()" style="margin-right: 10px;">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ —Å–Ω–æ–≤–∞
                            </button>
                            <button class="search-btn" onclick="window.sciSearcher.tryAlternativeSearch()" style="background: #28a745;">
                                üîç –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫
                            </button>
                        </div>
                    </div>
                `;
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —è–∑—ã–∫–æ–≤ –≤ —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
            analyzeLanguages() {
                if (!this.currentResults || this.currentResults.length === 0) {
                    console.log('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —è–∑—ã–∫–æ–≤');
                    return;
                }
                
                console.log('=== –ê–ù–ê–õ–ò–ó –Ø–ó–´–ö–û–í –í –¢–ï–ö–£–©–ò–• –†–ï–ó–£–õ–¨–¢–ê–¢–ê–• ===');
                
                const allLanguages = new Set();
                const languageStats = {};
                
                this.currentResults.forEach(work => {
                    const lang = work.language || '–Ω–µ —É–∫–∞–∑–∞–Ω';
                    allLanguages.add(lang);
                    languageStats[lang] = (languageStats[lang] || 0) + 1;
                });
                
                console.log('–í—Å–µ —è–∑—ã–∫–∏ –≤ —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö:', Array.from(allLanguages));
                console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —è–∑—ã–∫–æ–≤:', languageStats);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞
                Object.keys(languageStats).forEach(lang => {
                    const examples = this.currentResults.filter(work => (work.language || '–Ω–µ —É–∫–∞–∑–∞–Ω') === lang).slice(0, 3);
                    console.log(`–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —è–∑—ã–∫–∞ "${lang}":`, examples.map(w => w.title?.substring(0, 50) + '...'));
                });
                
                console.log('=== –ö–û–ù–ï–¶ –ê–ù–ê–õ–ò–ó–ê ===');
            }

            // –ú–µ—Ç–æ–¥—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
            getCacheKey(keywords, startYear, endYear, resultsLimit, sortOrder, filterType, language, openAccess) {
                return `${keywords}_${startYear}_${endYear}_${resultsLimit}_${sortOrder}_${filterType}_${language}_${openAccess}`;
            }

            getFromCache(key) {
                const cached = this.cache.get(key);
                if (cached && Date.now() - cached.timestamp < this.cacheExpiry) {
                    console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã');
                    return cached.data;
                }
                return null;
            }

            setCache(key, data) {
                this.cache.set(key, {
                    data: data,
                    timestamp: Date.now()
                });
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –∫—ç—à');
            }

        }

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        function loadSettings() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞
            const savedSettings = localStorage.getItem('searchSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    if (settings.sortOrder) document.getElementById('sortOrder').value = settings.sortOrder;
                    if (settings.filterType) document.getElementById('filterType').value = settings.filterType;
                    if (settings.language) document.getElementById('language').value = settings.language;
                    if (settings.openAccess) document.getElementById('openAccess').value = settings.openAccess;
                    if (settings.resultsLimit) document.getElementById('resultsLimit').value = settings.resultsLimit;
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', e);
                }
            }
        }

        function saveSettings() {
            const settings = {
                sortOrder: document.getElementById('sortOrder').value,
                filterType: document.getElementById('filterType').value,
                language: document.getElementById('language').value,
                openAccess: document.getElementById('openAccess').value,
                resultsLimit: document.getElementById('resultsLimit').value
            };
            localStorage.setItem('searchSettings', JSON.stringify(settings));
        }

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Enter - –ø–æ–∏—Å–∫
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                const searchBtn = document.getElementById('openalexSearchBtn');
                if (searchBtn) searchBtn.click();
            }
            
            // Escape - –æ—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            if (e.key === 'Escape') {
                const resultsPanel = document.getElementById('resultsPanel');
                if (resultsPanel && resultsPanel.style.display !== 'none') {
                    resultsPanel.style.display = 'none';
                }
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 6 –ª–µ—Ç
            const currentYear = new Date().getFullYear();
            const startYearDefault = currentYear - 5; // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 6 –ª–µ—Ç (–≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–∏–π)
            
            const startYearInput = document.getElementById('startYear');
            const endYearInput = document.getElementById('endYear');
            
            if (startYearInput) {
                startYearInput.placeholder = startYearDefault.toString();
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ
                if (!startYearInput.value) {
                    startYearInput.value = startYearDefault;
                }
            }
            
            if (endYearInput) {
                endYearInput.placeholder = currentYear.toString();
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ
                if (!endYearInput.value) {
                    endYearInput.value = currentYear;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞ –≤ –ø–æ–¥—Å–∫–∞–∑–∫–µ
            const currentYearDisplay = document.getElementById('currentYearDisplay');
            if (currentYearDisplay) {
                currentYearDisplay.textContent = currentYear.toString();
            }
            
            loadSettings();
            window.sciSearcher = new SciSearcher();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            ['sortOrder', 'filterType', 'language', 'openAccess', 'resultsLimit'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', saveSettings);
                }
            });
        });
    </script>
</body>
</html>
