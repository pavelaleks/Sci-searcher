<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Sci-Searcher</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .debug-section { margin: 20px 0; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .warning { border-left: 4px solid #ffc107; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîç Debug Sci-Searcher</h1>
    
    <div class="debug-section">
        <h3>1. –°—Ç–∞—Ç—É—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</h3>
        <p id="initStatus">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</p>
    </div>
    
    <div class="debug-section">
        <h3>2. –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–∏—Å–∫–∞</h3>
        <input type="text" id="testKeywords" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞" value="–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ">
        <button onclick="testSimpleSearch()">–¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</button>
        <p id="searchResult">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
    </div>
    
    <div class="debug-section">
        <h3>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—ã</h3>
        <button onclick="checkFormElements()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã</button>
        <p id="formElements">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</p>
    </div>
    
    <div class="debug-section">
        <h3>4. –õ–æ–≥ –∫–æ–Ω—Å–æ–ª–∏</h3>
        <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        <div id="consoleLog" class="log"></div>
    </div>
    
    <div class="debug-section">
        <h3>5. –¢–µ—Å—Ç API –Ω–∞–ø—Ä—è–º—É—é</h3>
        <button onclick="testDirectAPI()">–¢–µ—Å—Ç API</button>
        <p id="apiResult">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
    </div>

    <script>
        let logMessages = [];
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            logMessages.push(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
            updateLogDisplay();
        }
        
        console.log = function(...args) {
            addToLog(args.join(' '), 'log');
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addToLog(args.join(' '), 'error');
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            addToLog(args.join(' '), 'warn');
            originalWarn.apply(console, args);
        };
        
        function updateLogDisplay() {
            const logElement = document.getElementById('consoleLog');
            logElement.innerHTML = logMessages.slice(-20).join('<br>');
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            logMessages = [];
            updateLogDisplay();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        function checkInitialization() {
            const initStatus = document.getElementById('initStatus');
            
            try {
                if (typeof SciSearcher === 'undefined') {
                    initStatus.innerHTML = '‚ùå –ö–ª–∞—Å—Å SciSearcher –Ω–µ –Ω–∞–π–¥–µ–Ω';
                    initStatus.parentElement.className = 'debug-section error';
                    return false;
                }
                
                if (!window.sciSearcher) {
                    initStatus.innerHTML = '‚ùå –≠–∫–∑–µ–º–ø–ª—è—Ä sciSearcher –Ω–µ —Å–æ–∑–¥–∞–Ω';
                    initStatus.parentElement.className = 'debug-section error';
                    return false;
                }
                
                initStatus.innerHTML = '‚úÖ SciSearcher –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ';
                initStatus.parentElement.className = 'debug-section success';
                return true;
            } catch (error) {
                initStatus.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message;
                initStatus.parentElement.className = 'debug-section error';
                return false;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—ã
        function checkFormElements() {
            const formElements = document.getElementById('formElements');
            const elements = [
                'openalexForm',
                'keywords', 
                'openalexSearchBtn',
                'startYear',
                'endYear',
                'resultsLimit',
                'sortOrder',
                'filterType',
                'language',
                'openAccess'
            ];
            
            let found = 0;
            let missing = [];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    found++;
                } else {
                    missing.push(id);
                }
            });
            
            if (missing.length === 0) {
                formElements.innerHTML = `‚úÖ –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã (${found}/${elements.length})`;
                formElements.parentElement.className = 'debug-section success';
            } else {
                formElements.innerHTML = `‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${found}/${elements.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç: ${missing.join(', ')}`;
                formElements.parentElement.className = 'debug-section warning';
            }
        }
        
        // –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–æ–∏—Å–∫–∞
        async function testSimpleSearch() {
            const searchResult = document.getElementById('searchResult');
            const keywords = document.getElementById('testKeywords').value;
            
            searchResult.innerHTML = 'üîÑ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫...';
            
            try {
                if (!window.sciSearcher) {
                    throw new Error('SciSearcher –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
                
                const results = await window.sciSearcher.searchOpenAlex(keywords, 2020, 2023, 10, 'newest', 'all', 'all', 'all');
                
                searchResult.innerHTML = `‚úÖ –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ù–∞–π–¥–µ–Ω–æ ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`;
                searchResult.parentElement.className = 'debug-section success';
                
                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:', results);
                
            } catch (error) {
                searchResult.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}`;
                searchResult.parentElement.className = 'debug-section error';
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
            }
        }
        
        // –¢–µ—Å—Ç API –Ω–∞–ø—Ä—è–º—É—é
        async function testDirectAPI() {
            const apiResult = document.getElementById('apiResult');
            apiResult.innerHTML = 'üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º API...';
            
            try {
                const response = await fetch('https://api.openalex.org/works?search=machine%20learning&per-page=5', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'User-Agent': 'Sci-Searcher/1.0 (Debug)'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    apiResult.innerHTML = `‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ–ª—É—á–µ–Ω–æ ${data.results?.length || 0} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`;
                    apiResult.parentElement.className = 'debug-section success';
                    console.log('API –æ—Ç–≤–µ—Ç:', data);
                } else {
                    apiResult.innerHTML = `‚ùå API –æ—à–∏–±–∫–∞: ${response.status} ${response.statusText}`;
                    apiResult.parentElement.className = 'debug-section error';
                }
            } catch (error) {
                apiResult.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`;
                apiResult.parentElement.className = 'debug-section error';
                console.error('API –æ—à–∏–±–∫–∞:', error);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Debug —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
            setTimeout(() => {
                checkInitialization();
                checkFormElements();
            }, 1000);
        });
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <script src="index.html"></script>
</body>
</html>

